



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="ja">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>第四章 Spring Boot Web 开发 - 学习笔记</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#spring-boot-web" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="学习笔记" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              学习笔记
            </span>
            <span class="md-header-nav__topic">
              
                第四章 Spring Boot Web 开发
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../.." title="学习笔记" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    学习笔记
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="主页" class="md-nav__link">
      主页
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../Python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../php/" title="PHP" class="md-nav__link">
      PHP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../ElasticSearch/" title="ElasticSearch" class="md-nav__link">
      ElasticSearch
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../JavaScript/" title="JavaScript" class="md-nav__link">
      JavaScript
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../MySQL/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../人工智能/" title="人工智能" class="md-nav__link">
      人工智能
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../LEK/" title="LEK" class="md-nav__link">
      LEK
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../设计模式/" title="设计模式" class="md-nav__link">
      设计模式
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../Linux/" title="Linux" class="md-nav__link">
      Linux
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../前端/" title="前端" class="md-nav__link">
      前端
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1web" class="md-nav__link">
    1、web 开发简介
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#webjars" class="md-nav__link">
    webjars&amp;静态资源映射规则
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thymeleaf" class="md-nav__link">
    引入 thymeleaf
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thymeleaf_1" class="md-nav__link">
    thymeleaf 语法
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#springmvc" class="md-nav__link">
    SpringMVC 自动配置原理
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#springmvc_1" class="md-nav__link">
    扩展与全面接管 SpringMVC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    引入资源
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    国际化
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    登陆&amp;拦截器
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restful-crud" class="md-nav__link">
    Restful CRUD
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-" class="md-nav__link">
    员工列表-公共页抽取
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hiddenhttpmethodfilter" class="md-nav__link">
    HiddenHttpMethodFilter
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    错误页面
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servlet" class="md-nav__link">
    嵌入式 Servlet 容器配置修改
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servlet_1" class="md-nav__link">
    注册 servlet 三大组件
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servlet_2" class="md-nav__link">
    其他 Servlet 容器
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="spring-boot-web">第四章 Spring Boot Web 开发</h1>
<h2 id="1web">1、web 开发简介</h2>
<p>https://start.spring.io/</p>
<ol>
<li>创建 SpringBoot 应用，选中需要的模块</li>
<li>使用 SpringBoot 自动配置</li>
<li>编写业务代码</li>
</ol>
<div class="codehilite"><pre><span></span><span class="o">*</span><span class="n">AutoConfiguration</span> <span class="err">自动配置组件</span>
<span class="o">*</span><span class="n">Properties</span> <span class="err">封装配置文件的内容</span>
</pre></div>


<h2 id="webjars">webjars&amp;静态资源映射规则</h2>
<p>1、webjars</p>
<p>配置类：WebMvcAutoConfiguration</p>
<p>webjars 以 jar 包的方式引入静态资源</p>
<p>https://www.webjars.org/</p>
<p>资源路径映射</p>
<div class="codehilite"><pre><span></span><span class="o">/</span><span class="n">webjars</span><span class="cm">/**</span>

<span class="cm">=&gt;</span>

<span class="cm">classpath:/META-INF/resources/webjars/</span>
</pre></div>


<p>添加 jquery 依赖</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.webjars<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>jquery<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>3.5.1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>


<p>访问路径</p>
<p>/webjars/jquery/3.5.1/jquery.js</p>
<p>2、静态资源映射规则</p>
<p>静态资源文件夹</p>
<div class="codehilite"><pre><span></span><span class="n">classpath:</span>/<span class="n">META-INF</span><span class="o">/</span><span class="n">resources</span>/
<span class="n">classpath:</span>/<span class="n">resources</span>/
<span class="n">classpath:</span>/<span class="n">static</span>/
<span class="n">classpath:</span>/<span class="n">public</span>/
/ <span class="n">当前项目根路径</span>
</pre></div>


<p>默认静态文件下查找</p>
<div class="codehilite"><pre><span></span><span class="c1"># 欢迎页面</span>
index.html

<span class="c1"># 图标路径</span>
favicon.ico
</pre></div>


<p>自定义静态资源文件路径,默认资源路径失效</p>
<div class="codehilite"><pre><span></span><span class="n">spring</span><span class="p">.</span><span class="n">resources</span><span class="p">.</span><span class="k">static</span><span class="o">-</span><span class="n">locations</span><span class="o">=</span><span class="n">classpath</span><span class="p">:</span><span class="o">/</span><span class="n">hello</span><span class="o">/</span>
</pre></div>


<h2 id="thymeleaf">引入 thymeleaf</h2>
<p>JSP、Velocity、Thymeleaf、Freemarker</p>
<p>模板引擎</p>
<div class="codehilite"><pre><span></span>Template <span class="cp">${</span><span class="n">name</span><span class="cp">}</span>  + Data {&quot;name&quot;: &quot;Tom&quot;}

=&gt; TemplateEngine =&gt;

output
</pre></div>


<p>Thymeleaf 依赖</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;java.version&gt;</span>1.8<span class="nt">&lt;/java.version&gt;</span>
    <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>

    <span class="c">&lt;!-- 切换 thymeleaf version --&gt;</span>
    <span class="c">&lt;!-- thymeleaf3 适配 layout2 --&gt;</span>
    <span class="nt">&lt;springboot-thymeleaf.version&gt;</span>2.1.1.RELEASE<span class="nt">&lt;/springboot-thymeleaf.version&gt;</span>
    <span class="nt">&lt;thymeleaf-layout-dialect.version&gt;</span>2.0.0<span class="nt">&lt;/thymeleaf-layout-dialect.version&gt;</span>
<span class="nt">&lt;/properties&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>${springboot-thymeleaf.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>


<h2 id="thymeleaf_1">thymeleaf 语法</h2>
<p>https://www.thymeleaf.org/</p>
<p>默认配置</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThymeleafProperties</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">&quot;classpath:/templates/&quot;</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">suffix</span> <span class="o">=</span> <span class="s">&quot;.html&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>


<p>模板使用示例</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IndexController</span> <span class="o">{</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;/hello&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="o">(</span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">){</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Tom&quot;</span><span class="o">);</span>

        <span class="c1">// 模板路径</span>
        <span class="c1">// src/main/resources/templates/about.html</span>
        <span class="k">return</span> <span class="s">&quot;hello&quot;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>模板：</p>
<p>src/main/resources/templates/about.html</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="c">&lt;!-- 设置文本内容 --&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${name}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>


<p>语法规则</p>
<div class="codehilite"><pre><span></span><span class="nv">th</span>: 任意<span class="nv">html</span>属性，用来替换原生属性的值

<span class="nv">th</span>:<span class="nv">text</span> 改变文本内容<span class="ss">(</span>转义<span class="ss">)</span>
<span class="nv">th</span>:<span class="nv">utext</span> 改变文本内容<span class="ss">(</span>不转义<span class="ss">)</span>

<span class="nv">th</span>:<span class="nv">attr</span>
<span class="nv">th</span>:<span class="nv">href</span>
<span class="nv">th</span>:<span class="nv">src</span>

<span class="nv">th</span>:<span class="nv">each</span>
<span class="nv">th</span>:<span class="k">for</span>
</pre></div>


<p>表达式</p>
<div class="codehilite"><pre><span></span><span class="cp">${</span><span class="p">}</span> <span class="err">变量表达式</span>
    <span class="err">获取变量值</span>
    <span class="err">获取变量属性</span>
    <span class="err">调用方法</span>
    <span class="err">内置基本对象</span><span class="p">:</span> <span class="c1">#ctx #session...</span>
    <span class="err">内置工具对象：</span>

<span class="o">*</span><span class="p">{</span><span class="cp">}</span> 选择表达式
    配合th:object使用

#{} 获取国际化内容

@{} 定义url

~{} 片段表达式

字面量
数学运算
布尔运算
比较运算
条件运算
特殊操作
</pre></div>


<p>示例</p>
<div class="codehilite"><pre><span></span><span class="c">&lt;!--文本输出--&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${name}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="c">&lt;!--循环遍历--&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;pet: ${pets}&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>[[${pet}]]<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="c">&lt;!--循环遍历--&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;pet: ${pets}&quot;</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;pet&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>


<h2 id="springmvc">SpringMVC 自动配置原理</h2>
<p>SpringBoot 对 SpringMVC 默认配置</p>
<p>自动配置</p>
<div class="codehilite"><pre><span></span><span class="n">ViewResolver</span> <span class="err">视图解析器</span>
<span class="err">根据方法返回值的到视图对象（</span><span class="k">View</span><span class="err">）</span>
<span class="err">视图对象决定如何渲染、转发、重定向</span>

<span class="n">Converter</span> <span class="err">类型转换器</span>
<span class="n">Formatter</span> <span class="err">格式化器</span>
<span class="n">HttpMessageConverters</span> <span class="err">转换请求响应</span>
<span class="n">MessageCodesResolver</span> <span class="err">定义错误代码生成规则</span>
<span class="n">WebDataBinder</span> <span class="err">数据绑定器</span>
</pre></div>


<p>修改 SpringBoot 默认配置</p>
<p>优先使用用户配置@Bean/@Component<br />
如果没有才自动配置<br />
有些组件可以有多个</p>
<p>eg: ViewResolver 将用户配置和默认配置组合起来</p>
<h2 id="springmvc_1">扩展与全面接管 SpringMVC</h2>
<p>1、扩展配置</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.ViewControllerRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter</span><span class="o">;</span>

<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomVmcConfig</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addViewControllers</span><span class="o">(</span><span class="n">ViewControllerRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// super.addViewControllers(registry);</span>
        <span class="c1">// 浏览器的请求 /demo 到视图 /hello</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">&quot;demo&quot;</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">&quot;hello&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>2、全面接管</p>
<p>增加 <code>@EnableWebMvc</code> 后，自动配置失效</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.EnableWebMvc</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.ViewControllerRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter</span><span class="o">;</span>

<span class="nd">@EnableWebMvc</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomVmcConfig</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addViewControllers</span><span class="o">(</span><span class="n">ViewControllerRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// super.addViewControllers(registry);</span>
        <span class="c1">// 浏览器的请求 /demo 到视图 /hello</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">&quot;demo&quot;</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">&quot;hello&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h2 id="_1">引入资源</h2>
<p>模板资源: https://getbootstrap.net/</p>
<p>模板语法: https://www.thymeleaf.org/</p>
<p>webjars: https://www.webjars.org/</p>
<p>目录设置</p>
<div class="codehilite"><pre><span></span><span class="n">resources</span><span class="o">/</span>
    <span class="n">templates</span>   <span class="err">模板文件</span>
    <span class="k">static</span>      <span class="err">静态文件</span>
</pre></div>


<p>首页设置</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.ViewControllerRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter</span><span class="o">;</span>


<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomVmcConfig</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span> <span class="o">{</span>


    <span class="c1">// 设置首页位置，默认访问 public/index.html 没有经过模板引擎处理</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">WebMvcConfigurerAdapter</span> <span class="nf">CustomVmcConfig</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">WebMvcConfigurerAdapter</span> <span class="n">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WebMvcConfigurerAdapter</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addViewControllers</span><span class="o">(</span><span class="n">ViewControllerRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">&quot;login&quot;</span><span class="o">);</span>
                <span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">&quot;/index.html&quot;</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">&quot;login&quot;</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">};</span>

        <span class="k">return</span> <span class="n">adapter</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h2 id="_2">国际化</h2>
<p>默认根据浏览器语言获取对应国际化信息</p>
<p>1、配置语言文件</p>
<p>resources 资源文件夹下</p>
<div class="codehilite"><pre><span></span><span class="err">├──</span> <span class="n">i18n</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">login</span><span class="p">.</span><span class="n">properties</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">login_en_US</span><span class="p">.</span><span class="n">properties</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="n">login_zh_CN</span><span class="p">.</span><span class="n">properties</span>
</pre></div>


<p>默认配置 login.properties</p>
<div class="codehilite"><pre><span></span><span class="n">login</span><span class="p">.</span><span class="n">button</span><span class="o">=</span><span class="err">登录</span><span class="o">~</span>
<span class="n">login</span><span class="p">.</span><span class="n">title</span><span class="o">=</span><span class="err">登录</span><span class="o">~</span>
<span class="n">login</span><span class="p">.</span><span class="n">username</span><span class="o">=</span><span class="err">用户名</span><span class="o">~</span>
<span class="n">login</span><span class="p">.</span><span class="n">password</span><span class="o">=</span><span class="err">密码</span><span class="o">~</span>
<span class="n">login</span><span class="p">.</span><span class="n">remember</span><span class="o">=</span><span class="err">记住我</span><span class="o">~</span>
</pre></div>


<p>英文配置 login_en_US.properties</p>
<div class="codehilite"><pre><span></span><span class="n">login</span><span class="p">.</span><span class="n">button</span><span class="o">=</span><span class="n">Sign</span> <span class="k">In</span>
<span class="n">login</span><span class="p">.</span><span class="n">title</span><span class="o">=</span><span class="n">Login</span>
<span class="n">login</span><span class="p">.</span><span class="n">username</span><span class="o">=</span><span class="n">UserName</span>
<span class="n">login</span><span class="p">.</span><span class="n">password</span><span class="o">=</span><span class="n">Password</span>
<span class="n">login</span><span class="p">.</span><span class="n">remember</span><span class="o">=</span><span class="n">Remenber</span> <span class="n">Me</span>
</pre></div>


<p>中文配置 login_zh_CN.properties</p>
<div class="codehilite"><pre><span></span><span class="n">login</span><span class="p">.</span><span class="n">button</span><span class="o">=</span><span class="err">登录</span>
<span class="n">login</span><span class="p">.</span><span class="n">title</span><span class="o">=</span><span class="err">登录</span>
<span class="n">login</span><span class="p">.</span><span class="n">username</span><span class="o">=</span><span class="err">用户名</span>
<span class="n">login</span><span class="p">.</span><span class="n">password</span><span class="o">=</span><span class="err">密码</span>
<span class="n">login</span><span class="p">.</span><span class="n">remember</span><span class="o">=</span><span class="err">记住我</span>
</pre></div>


<p>2、配置 application.yml</p>
<div class="codehilite"><pre><span></span><span class="nv">spring</span>:
  <span class="nv">messages</span>:
    <span class="k">basename</span>: <span class="nv">i18n</span>.<span class="nv">login</span>
</pre></div>


<p>3、模板文件中使用</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">button</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;#{login.button}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</pre></div>


<p>根据浏览器请求头设置语言</p>
<div class="codehilite"><pre><span></span><span class="nt">GET</span> <span class="nt">http</span><span class="o">://</span><span class="nt">localhost</span><span class="p">:</span><span class="nd">8080</span><span class="o">/</span>
<span class="nt">Accept-Language</span><span class="o">:</span> <span class="nt">en-US</span><span class="o">,</span><span class="nt">en</span><span class="o">;</span><span class="nt">q</span><span class="o">=</span><span class="nt">0</span><span class="p">.</span><span class="nc">9</span><span class="o">,</span><span class="nt">zh-CN</span><span class="o">;</span><span class="nt">q</span><span class="o">=</span><span class="nt">0</span><span class="p">.</span><span class="nc">8</span><span class="o">,</span><span class="nt">zh</span><span class="o">;</span><span class="nt">q</span><span class="o">=</span><span class="nt">0</span><span class="p">.</span><span class="nc">7</span>
</pre></div>


<p>4、自定义国际化处理器</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.component</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.util.StringUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.LocaleResolver</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Locale</span><span class="o">;</span>


<span class="cm">/**</span>
<span class="cm"> * 区域信息解析器</span>
<span class="cm"> * 自定义国际化参数，支持链接上携带区域信息</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyLocaleResolver</span> <span class="kd">implements</span> <span class="n">LocaleResolver</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Locale</span> <span class="nf">resolveLocale</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">lang</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;lang&quot;</span><span class="o">);</span>

        <span class="n">Locale</span> <span class="n">locale</span> <span class="o">=</span> <span class="n">Locale</span><span class="o">.</span><span class="na">getDefault</span><span class="o">();</span>

        <span class="k">if</span> <span class="o">(!</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">lang</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">String</span><span class="o">[]</span> <span class="n">list</span> <span class="o">=</span> <span class="n">lang</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">&quot;_&quot;</span><span class="o">);</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">locale</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Locale</span><span class="o">(</span><span class="n">list</span><span class="o">[</span><span class="mi">0</span><span class="o">],</span> <span class="n">list</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">locale</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLocale</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">httpServletRequest</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">httpServletResponse</span><span class="o">,</span> <span class="n">Locale</span> <span class="n">locale</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>启用自定义国际化处理器</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.demo.component.MyLocaleResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.ViewControllerRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter</span><span class="o">;</span>


<span class="cm">/**</span>
<span class="cm"> * 配置首页视图</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomVmcConfig</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">MyLocaleResolver</span> <span class="nf">localeResolver</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">MyLocaleResolver</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>优先获取查询参数返回语言设置</p>
<div class="codehilite"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="o">/?</span><span class="n">lang</span><span class="o">=</span><span class="n">zh_CN</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="o">/?</span><span class="n">lang</span><span class="o">=</span><span class="n">en_US</span>
</pre></div>


<h2 id="_3">登陆&amp;拦截器</h2>
<p>开发期间模板引擎修改要实时生效</p>
<ol>
<li>禁用模板引擎缓存</li>
<li>重新编译</li>
</ol>
<div class="codehilite"><pre><span></span><span class="c">&lt;!--登录错误消息提示--&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span>
  <span class="na">style</span><span class="o">=</span><span class="s">&quot;color: red;&quot;</span>
  <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${msg}&quot;</span>
  <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${not #strings.isEmpty(msg)}&quot;</span>
<span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>


<p>拦截器进行登录检查</p>
<p>登录</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.util.StringUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSession</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginController</span> <span class="o">{</span>
    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&quot;/user/login&quot;</span><span class="o">)</span>
    <span class="c1">// 等价于 @RequestMapping(value = &quot;/user/login&quot;, method = {RequestMethod.POST})</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&quot;username&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">username</span><span class="o">,</span>
                        <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&quot;password&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">password</span><span class="o">,</span>
                        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span><span class="o">,</span>
                        <span class="n">HttpSession</span> <span class="n">session</span>
    <span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">username</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;123&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">password</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;loginUser&quot;</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>
            <span class="c1">// 登录成功 防止表单重新提交，做一个重定向</span>
            <span class="k">return</span> <span class="s">&quot;redirect:/dashboard.html&quot;</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">// 登录失败</span>
            <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;msg&quot;</span><span class="o">,</span> <span class="s">&quot;账号或密码不正确&quot;</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">&quot;login&quot;</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>拦截器</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.component</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.HandlerInterceptor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ModelAndView</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * 登录检查</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginHandlerInterceptor</span> <span class="kd">implements</span> <span class="n">HandlerInterceptor</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">Object</span> <span class="n">loginUser</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;loginUser&quot;</span><span class="o">);</span>
        <span class="c1">// 未登录，返回登录页面</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">loginUser</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;msg&quot;</span><span class="o">,</span> <span class="s">&quot;没有权限，请先登录&quot;</span><span class="o">);</span>
            <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">&quot;/index.html&quot;</span><span class="o">).</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">// 已登录，放行</span>
        <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>注册拦截器</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.demo.component.LoginHandlerInterceptor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.demo.component.MyLocaleResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.InterceptorRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.ViewControllerRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter</span><span class="o">;</span>


<span class="cm">/**</span>
<span class="cm"> * 配置首页视图</span>
<span class="cm"> */</span>

<span class="nd">@Configuration</span>
<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&quot;all&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomVmcConfig</span> <span class="kd">extends</span> <span class="n">WebMvcConfigurerAdapter</span> <span class="o">{</span>
    <span class="c1">// 设置首页位置，默认访问 public/index.html 没有经过模板引擎处理</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">WebMvcConfigurerAdapter</span> <span class="nf">CustomVmcConfig</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">WebMvcConfigurerAdapter</span> <span class="n">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WebMvcConfigurerAdapter</span><span class="o">()</span> <span class="o">{</span>
            <span class="cm">/**</span>
<span class="cm">             * 注册视图控制器</span>
<span class="cm">             * @param registry</span>
<span class="cm">             */</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addViewControllers</span><span class="o">(</span><span class="n">ViewControllerRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">&quot;login&quot;</span><span class="o">);</span>
                <span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">&quot;/index.html&quot;</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">&quot;login&quot;</span><span class="o">);</span>
                <span class="n">registry</span><span class="o">.</span><span class="na">addViewController</span><span class="o">(</span><span class="s">&quot;/dashboard.html&quot;</span><span class="o">).</span><span class="na">setViewName</span><span class="o">(</span><span class="s">&quot;dashboard&quot;</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="cm">/**</span>
<span class="cm">             * 注册拦截器</span>
<span class="cm">             * @param registry</span>
<span class="cm">             */</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addInterceptors</span><span class="o">(</span><span class="n">InterceptorRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// super.addInterceptors(registry);</span>

                <span class="c1">// 拦截任意路径下的所有请求, 排除请求</span>
                <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="k">new</span> <span class="n">LoginHandlerInterceptor</span><span class="o">())</span>
                        <span class="o">.</span><span class="na">addPathPatterns</span><span class="o">(</span><span class="s">&quot;/**&quot;</span><span class="o">)</span>
                        <span class="o">.</span><span class="na">excludePathPatterns</span><span class="o">(</span><span class="s">&quot;/index.html&quot;</span><span class="o">,</span> <span class="s">&quot;/&quot;</span><span class="o">,</span> <span class="s">&quot;/user/login&quot;</span><span class="o">,</span> <span class="s">&quot;/static/**&quot;</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">};</span>

        <span class="k">return</span> <span class="n">adapter</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>


<h2 id="restful-crud">Restful CRUD</h2>
<p>Rest 风格<br />
URI： /资源/资源标识 HTTP 请求方式区分对资源 CRUD</p>
<table>
<thead>
<tr>
<th>说明</th>
<th>普通 CRUD(URI 区分操作)</th>
<th>RestfulCRUD</th>
</tr>
</thead>
<tbody>
<tr>
<td>查询</td>
<td>getEmp</td>
<td>GET emp</td>
</tr>
<tr>
<td>添加</td>
<td>addEmp</td>
<td>POST emp</td>
</tr>
<tr>
<td>修改</td>
<td>updateEmp?id=1</td>
<td>PUT emp/{id}</td>
</tr>
<tr>
<td>删除</td>
<td>deleteEmp?id=1</td>
<td>DELETE emp/{id}</td>
</tr>
</tbody>
</table>
<p>查询接口定义</p>
<table>
<thead>
<tr>
<th>说明</th>
<th>请求方式</th>
<th>请求 URI</th>
</tr>
</thead>
<tbody>
<tr>
<td>查询所有员工</td>
<td>GET</td>
<td>emps</td>
</tr>
<tr>
<td>查询某个员工</td>
<td>GET</td>
<td>emp/{id}</td>
</tr>
<tr>
<td>添加页面</td>
<td>GET</td>
<td>emp</td>
</tr>
<tr>
<td>添加员工</td>
<td>POST</td>
<td>emp</td>
</tr>
<tr>
<td>修改页面</td>
<td>GET</td>
<td>emp/{id}</td>
</tr>
<tr>
<td>修改员工</td>
<td>PUT</td>
<td>emp</td>
</tr>
<tr>
<td>删除员工</td>
<td>DELETE</td>
<td>emp/{id}</td>
</tr>
</tbody>
</table>
<h2 id="-">员工列表-公共页抽取</h2>
<p>公共片段抽取</p>
<div class="codehilite"><pre><span></span><span class="c">&lt;!-- 1、抽取公共片段 --&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:fragment</span><span class="o">=</span><span class="s">&quot;copy&quot;</span><span class="p">&gt;</span>content<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="c">&lt;!-- 2、引入公共片段 --&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:insert</span><span class="o">=</span><span class="s">&quot;~{footer::copy}&quot;</span><span class="p">&gt;</span>content<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="c">&lt;!-- 3、默认效果 --&gt;</span>
<span class="c">&lt;!-- insert功能片段在div标签中 --&gt;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="o">~</span><span class="err">{</span><span class="n">templateName</span><span class="p">::</span><span class="n">selector</span><span class="err">}</span> <span class="err">模板名</span><span class="p">::</span><span class="err">选择器</span>
<span class="o">~</span><span class="err">{</span><span class="n">templateName</span><span class="p">::</span><span class="n">fragmentName</span><span class="err">}模板名</span><span class="p">::</span><span class="err">片段名</span>
</pre></div>


<p>3 种方式引入片段</p>
<div class="codehilite"><pre><span></span><span class="nv">th</span>:<span class="nv">insert</span> 插入
<span class="nv">th</span>:<span class="nv">replace</span> 替换
<span class="nv">th</span>:<span class="k">include</span> 引入片段内容

使用<span class="nv">th</span>:<span class="nv">insert</span>可以不写<span class="o">~</span>{}
转义[[<span class="o">~</span>{}]]
不转义[<span class="ss">(</span><span class="o">~</span>{}<span class="ss">)</span>]
</pre></div>


<p>引入片段时候传入参数</p>
<p>链接高亮&amp;列表完成</p>
<p>redirect 重定向<br />
forward 转发</p>
<p>日期格式化</p>
<div class="codehilite"><pre><span></span><span class="n">spring</span><span class="p">.</span><span class="n">mvc</span><span class="p">.</span><span class="n">format</span><span class="p">.</span><span class="nb">date</span><span class="p">:</span> <span class="n">yyyy</span><span class="o">-</span><span class="n">MM</span><span class="o">-</span><span class="n">dd</span>
</pre></div>


<h2 id="hiddenhttpmethodfilter">HiddenHttpMethodFilter</h2>
<p>SpringMVC 中配置 HiddenHttpMethodFilter<br />
页面创建一个 Post 表单<br />
创建一个 input 项 name="_method"，值就是请求方式</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;_method&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;put&quot;</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${emp!=null}&quot;</span> <span class="p">/&gt;</span>
</pre></div>


<p>有些版本可能需要配置<br />
application.yml</p>
<div class="codehilite"><pre><span></span><span class="n">spring</span><span class="p">.</span><span class="n">mvc</span><span class="p">.</span><span class="n">hiddenmethod</span><span class="p">.</span><span class="n">filter</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="k">true</span>
</pre></div>


<h2 id="_4">错误页面</h2>
<p>ErrorMvcAutoConfiguration</p>
<p>有模板引擎的情况下</p>
<div class="codehilite"><pre><span></span><span class="n">error</span><span class="o">/</span><span class="err">状态码</span>

<span class="n">eg</span><span class="p">:</span>
<span class="err">精确匹配</span>
<span class="n">error</span><span class="o">/</span><span class="mi">404</span><span class="p">.</span><span class="n">html</span>

<span class="err">模糊匹配</span>
<span class="n">error</span><span class="o">/</span><span class="mi">4</span><span class="n">xx</span><span class="p">.</span><span class="n">html</span>
<span class="n">error</span><span class="o">/</span><span class="mi">5</span><span class="n">xx</span><span class="p">.</span><span class="n">html</span>
</pre></div>


<p>自定义异常处理</p>
<p>1、返回 JSON 数据</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ControllerAdvice</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ExceptionHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="nd">@ControllerAdvice</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExceptionController</span> <span class="o">{</span>

    <span class="nd">@ResponseBody</span>
    <span class="nd">@ExceptionHandler</span>
    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">handleException</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;code&quot;</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;msg&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">map</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;用户不存在&quot;</span><span class="p">,</span>
  <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="mi">-1</span>
<span class="p">}</span>
</pre></div>


<h2 id="servlet">嵌入式 Servlet 容器配置修改</h2>
<p>Tomcat<br />
通用配置</p>
<div class="codehilite"><pre><span></span><span class="c1"># servlet配置</span>
server.port<span class="o">=</span><span class="m">8001</span>
server.context-path<span class="o">=</span>/demo

<span class="c1"># Tomcat配置</span>
server.tomcat.uri-encoding<span class="o">=</span>UTF-8
</pre></div>


<h2 id="servlet_1">注册 servlet 三大组件</h2>
<p>Servlet/Filter/Listener</p>
<p>1、Servlet</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.servlet</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServlet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">resp</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;MyServlet&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>2、Filter</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.filter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyFilter</span> <span class="kd">implements</span> <span class="n">Filter</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">ServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">FilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;MyFilter&quot;</span><span class="o">);</span>
        <span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>3、Listener</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.listener</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ServletContextEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletContextListener</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyListener</span> <span class="kd">implements</span> <span class="n">ServletContextListener</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">contextInitialized</span><span class="o">(</span><span class="n">ServletContextEvent</span> <span class="n">sce</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;contextInitialized&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">contextDestroyed</span><span class="o">(</span><span class="n">ServletContextEvent</span> <span class="n">sce</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;contextDestroyed&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>注册组件</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.demo.filter.MyFilter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.demo.listener.MyListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.demo.servlet.MyServlet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.web.servlet.FilterRegistrationBean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.web.servlet.ServletListenerRegistrationBean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.web.servlet.ServletRegistrationBean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * 注册Servlet/Filter/Listener组件</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyServletConfig</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">ServletRegistrationBean</span> <span class="nf">myServlet</span><span class="o">(){</span>
        <span class="n">ServletRegistrationBean</span> <span class="n">registrationBean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServletRegistrationBean</span><span class="o">();</span>
        <span class="n">registrationBean</span><span class="o">.</span><span class="na">setServlet</span><span class="o">(</span><span class="k">new</span> <span class="n">MyServlet</span><span class="o">());</span>
        <span class="n">registrationBean</span><span class="o">.</span><span class="na">setUrlMappings</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&quot;/servlet&quot;</span><span class="o">));</span>
        <span class="k">return</span> <span class="n">registrationBean</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">FilterRegistrationBean</span> <span class="nf">myFilter</span><span class="o">(){</span>
        <span class="n">FilterRegistrationBean</span> <span class="n">registrationBean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FilterRegistrationBean</span><span class="o">();</span>
        <span class="n">registrationBean</span><span class="o">.</span><span class="na">setFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">MyFilter</span><span class="o">());</span>
        <span class="n">registrationBean</span><span class="o">.</span><span class="na">setUrlPatterns</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&quot;/servlet&quot;</span><span class="o">));</span>
        <span class="k">return</span> <span class="n">registrationBean</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">ServletListenerRegistrationBean</span> <span class="nf">myListener</span><span class="o">(){</span>
        <span class="n">ServletListenerRegistrationBean</span> <span class="n">registrationBean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServletListenerRegistrationBean</span><span class="o">(</span><span class="k">new</span> <span class="n">MyListener</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">registrationBean</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>访问</p>
<p>http://localhost:8080/servlet</p>
<p>默认拦截: /<br />
修改 server.servletPath</p>
<h2 id="servlet_2">其他 Servlet 容器</h2>
<p>Tomcat 默认<br />
Jetty 长连接<br />
Undertow 不支持 jsp</p>
<p>嵌入式容器<br />
外部容器</p>
<p>jar 包：执行 SpringBoot 主类的 main 方法，启动 IOC 容器，创建嵌入式的 Servlet 容器<br />
war 包：启动服务器，服务器启动 SpringBoot，启动 IOC 容器</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            2019-2021
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/mouday" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.808e90bb.js"></script>
      
        
        
          
          <script src="../../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../../assets/javascripts/lunr/lunr.ja.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
    
  </body>
</html>