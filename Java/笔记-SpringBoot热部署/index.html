



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="ja">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>笔记 SpringBoot热部署 - 学习笔记</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#_1" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="学习笔记" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              学习笔记
            </span>
            <span class="md-header-nav__topic">
              
                笔记 SpringBoot热部署
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="学习笔记" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    学习笔记
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="主页" class="md-nav__link">
      主页
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../php/" title="PHP" class="md-nav__link">
      PHP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../ElasticSearch/" title="ElasticSearch" class="md-nav__link">
      ElasticSearch
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../JavaScript/" title="JavaScript" class="md-nav__link">
      JavaScript
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../MySQL/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../人工智能/" title="人工智能" class="md-nav__link">
      人工智能
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../LEK/" title="LEK" class="md-nav__link">
      LEK
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../设计模式/" title="设计模式" class="md-nav__link">
      设计模式
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Linux/" title="Linux" class="md-nav__link">
      Linux
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    课程介绍
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    热部署与热加载
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    热部署原理解析
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#java" class="md-nav__link">
    Java类热加载案例分析
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#springboot" class="md-nav__link">
    SpringBoot
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spring-boot" class="md-nav__link">
    Spring Boot热部署的实现
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#springboot_1" class="md-nav__link">
    SpringBoot发布方式
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    遇到的问题:
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>笔记 SpringBoot热部署</h1>
                
                <p>Java笔记：SpringBoot热部署与热加载</p>
<h2 id="_1">课程介绍</h2>
<p>1、热部署使用场景</p>
<ul>
<li>本地调试</li>
<li>线上发布</li>
</ul>
<p>2、优点</p>
<ul>
<li>本地、线上都适用</li>
<li>无需重启服务器</li>
</ul>
<p>3、前置知识</p>
<ul>
<li>Java语言</li>
<li>Spring开发经验</li>
<li>构建SpringBoot项目</li>
</ul>
<p>4、课程大纲</p>
<ul>
<li>热部署原理分析</li>
<li>案例分析</li>
<li>项目演示</li>
<li>测试</li>
<li>发布程序</li>
<li>课程总结</li>
</ul>
<h2 id="_2">热部署与热加载</h2>
<p>1、Java热部署与热加载联系<br />
- 不重启服务器编译/部署项目<br />
- 基于Java的类加载器实现</p>
<p>2、Java热部署与热加载区别<br />
2.1、部署方式<br />
   - 热部署在服务器运行时重新部署项目<br />
   - 热加载在运行时重新加载class</p>
<p>2.2、实现原理<br />
   - 热部署直接重新加载整个应用<br />
   - 热加载在运行时重新加载class</p>
<p>2.3、使用场景<br />
   - 热部署多用于生产环境<br />
   - 热加载多用于开发环境</p>
<h2 id="_3">热部署原理解析</h2>
<p>1、Java类加载过程</p>
<div class="codehilite"><pre><span></span><span class="err">初始化</span><span class="n">JVM</span>
<span class="o">-&gt;</span> <span class="err">产生启动类加载器（子类，自动加载）</span>
<span class="o">-&gt;</span> <span class="err">标准扩展类加载器</span>
<span class="o">-&gt;</span> <span class="err">系统类加载器</span>
<span class="o">-&gt;</span> <span class="err">加载</span><span class="n">class文件</span>
</pre></div>


<p>2、类加载的5个阶段</p>
<div class="codehilite"><pre><span></span><span class="err">加载</span> <span class="err">允许用户参与</span>
<span class="err">验证</span>
<span class="err">准备</span>
<span class="err">解析</span>
<span class="err">初始化</span>
</pre></div>


<p>3、初始化时机5个</p>
<div class="codehilite"><pre><span></span><span class="mi">1</span><span class="err">、</span><span class="k">new</span> <span class="p">(</span><span class="n">final修饰的类会放在常量池</span><span class="p">)</span>
<span class="mi">2</span><span class="err">、反射</span>
<span class="mi">3</span><span class="err">、初始化类的时候其父类没有初始化</span>
<span class="mi">4</span><span class="err">、主类</span>
<span class="mi">5</span><span class="err">、</span><span class="k">static</span>
</pre></div>


<p>4、Java类加载器特点<br />
- 由AppClass Loader（系统类加载器）开始加载执行的类<br />
- 类加载器将加载任务交给其父，如果其父找不到，再由自己去加载<br />
- Bootstrap Loader（启动类加载器）是最顶级的类加载器</p>
<p>5、Java类的热部署</p>
<ul>
<li>类的热加载实现</li>
<li>配置Tomcat实现热部署<ol>
<li>直接把项目web文件夹放在webapps里</li>
<li>在<code>tomcat\conf\server.xml</code>中 <code>&lt;host&gt;&lt;/host&gt;</code>内部添加<code>&lt;Context/&gt;</code>标签</li>
<li>在<code>%tomcat_home%\conf\Catalina\localhost</code>中添加一个XML</li>
</ol>
</li>
</ul>
<p>tomcat\conf\server.xml</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;Context</span>  <span class="na">path=</span><span class="s">&quot;/hot&quot;</span> <span class="na">docBase=</span><span class="s">&quot;webapps&quot;</span> <span class="na">crossContext=</span><span class="s">&quot;true&quot;</span> <span class="na">debug=</span><span class="s">&quot;0&quot;</span> <span class="na">privileged=</span><span class="s">&quot;true&quot;</span>  <span class="na">reloadable=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/Context&gt;</span>
</pre></div>


<p>tomcat\conf\Catalina\localhost\demo.xml</p>
<p>使用文件名作为路径名</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;Context</span> <span class="na">docBase=</span><span class="s">&quot;websites&quot;</span>  <span class="na">reloadable=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</pre></div>


<h2 id="java">Java类热加载案例分析</h2>
<p>实现：<br />
1、类层次结构清晰，修改某一个java类文件不需要重启服务或者重新编译运行程序<br />
2、可以适当的运用一些设计模式使代码结构更加清晰明了，比如工厂模式</p>
<p>核心类MyClassLoader</p>
<h2 id="springboot">SpringBoot</h2>
<p>简化开发，库的集合</p>
<p>Restful、微服务</p>
<p>spring-tool-suite</p>
<h2 id="spring-boot">Spring Boot热部署的实现</h2>
<p>方式：<br />
1. Spring Loaded</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
        <span class="nt">&lt;plugin&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>

            <span class="nt">&lt;dependencies&gt;</span>
                <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework/springloaded --&gt;</span>
                <span class="nt">&lt;dependency&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>springloaded<span class="nt">&lt;/artifactId&gt;</span>
                    <span class="nt">&lt;version&gt;</span>1.2.8.RELEASE<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;/dependency&gt;</span>
            <span class="nt">&lt;/dependencies&gt;</span>
        <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span>
</pre></div>


<p>运行项目</p>
<div class="codehilite"><pre><span></span>$ mvn spring-boot:run
</pre></div>


<ol>
<li>Spring-boot-devtools</li>
</ol>
<div class="codehilite"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>


<p>IDEA修改项目文件后需要重新编译</p>
<h2 id="springboot_1">SpringBoot发布方式</h2>
<ul>
<li>构建Jar包，命令行运行SpringBoot程序</li>
<li>构建war包，发布到Tomcat</li>
</ul>
<p>1、构建Jar包</p>
<div class="codehilite"><pre><span></span><span class="c1"># 打包</span>
$ mvn package

<span class="c1"># 运行</span>
$ java -jar target/demo-0.0.1-SNAPSHOT.jar
</pre></div>


<p>2、构建war包</p>
<p>(1)修改配置文件3处</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-tomcat<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;build&gt;</span>
    <span class="c">&lt;!--生成war包的名称--&gt;</span>
    <span class="nt">&lt;finalName&gt;</span>demoapp<span class="nt">&lt;/finalName&gt;</span>
<span class="nt">&lt;/build&gt;</span>
</pre></div>


<p>(2) 新建类，Application为主类名</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.boot.builder.SpringApplicationBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.web.servlet.support.SpringBootServletInitializer</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServletInitializer</span> <span class="kd">extends</span> <span class="n">SpringBootServletInitializer</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">SpringApplicationBuilder</span> <span class="nf">configure</span><span class="o">(</span><span class="n">SpringApplicationBuilder</span> <span class="n">application</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">application</span><span class="o">.</span><span class="na">sources</span><span class="o">(</span><span class="n">Application</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>


<p>打包</p>
<div class="codehilite"><pre><span></span>$ mvn clean package
</pre></div>


<p>将打包后的war包放入webapps目录下，会自动解压</p>
<p>还可以在新建SpringBoot项目的时候直接选择war包方式</p>
<h2 id="_4">遇到的问题:</h2>
<p>使用 Apache Tomcat/7.0.100没有访问成功 出现404</p>
<p>Apache Tomcat/9.0.39 可以成功访问到</p>
<blockquote>
<p>参考<br />
<a href="https://www.imooc.com/article/49247">SpringBoot应用War包形式部署到外部Tomcat</a></p>
</blockquote>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            2019-2020
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/mouday" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../assets/javascripts/lunr/lunr.ja.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>