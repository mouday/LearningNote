



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="ja">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>11-JSP 快速入门 - 学习笔记</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#11-jsp" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="学习笔记" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              学习笔记
            </span>
            <span class="md-header-nav__topic">
              
                11-JSP 快速入门
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="学习笔记" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    学习笔记
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="主页" class="md-nav__link">
      主页
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../php/" title="PHP" class="md-nav__link">
      PHP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../ElasticSearch/" title="ElasticSearch" class="md-nav__link">
      ElasticSearch
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../JavaScript/" title="JavaScript" class="md-nav__link">
      JavaScript
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../MySQL/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../人工智能/" title="人工智能" class="md-nav__link">
      人工智能
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../LEK/" title="LEK" class="md-nav__link">
      LEK
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../设计模式/" title="设计模式" class="md-nav__link">
      设计模式
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Linux/" title="Linux" class="md-nav__link">
      Linux
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="11-jsp">11-JSP 快速入门</h1>
<h1 id="1-jsp">第 1 章 ： JSP 入门</h1>
<h2 id="1-jsp_1">课时 1 JSP 入门</h2>
<p>Java Server Pages</p>
<p>jsp 本质就是 Servlet</p>
<p>jsp：在原有 html 基础上添加 java 脚本</p>
<p>分工：</p>
<p>jsp 显示数据</p>
<p>servlet 处理数据</p>
<div class="codehilite"><pre><span></span><span class="n">jsp</span> <span class="o">-&gt;</span> <span class="n">servlet</span> <span class="o">-&gt;</span> <span class="n">jsp</span>
</pre></div>


<p>jsp 组成：</p>
<p>1、html + java 脚本 + jsp 标签（指令）</p>
<p>2、9 个内置对象：</p>
<div class="codehilite"><pre><span></span><span class="n">request</span>
<span class="n">response</span>
<span class="k">session</span>
<span class="n">application</span>
<span class="n">pageContext</span>
<span class="n">config</span>
<span class="k">out</span>
<span class="n">page</span>
<span class="k">exception</span>
</pre></div>


<p>3、3 种脚本</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;%</span> <span class="cp">%&gt;</span><span class="x"> Java代码片段，多条代码</span>
<span class="cp">&lt;%=%&gt;</span><span class="x"> Java表达式，一条代码</span>
<span class="cp">&lt;%</span><span class="o">!</span><span class="cp">%&gt;</span><span class="x"> 声明成员</span>
</pre></div>


<h2 id="2-jsp-java">课时 2 JSP 中 Java 脚本的演示</h2>
<p>html 中的 base 标签</p>
<div class="codehilite"><pre><span></span><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span> <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="k">%&gt;</span>

<span class="k">&lt;%</span>
<span class="c1">// java语句</span>
<span class="n">String</span> <span class="n">basePath</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getScheme</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;://&quot;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getServerName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getServerPort</span><span class="o">()</span> <span class="o">+</span>  <span class="n">request</span><span class="o">.</span><span class="na">getContextPath</span><span class="o">();</span>
<span class="c1">// http://localhost:8080/demo</span>
<span class="k">%&gt;</span>

<span class="k">&lt;%=</span><span class="n">basePath</span><span class="k">%&gt;</span>

<span class="k">&lt;%</span>
<span class="c1">// 等价于</span>
<span class="n">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">basePath</span><span class="o">);</span>
<span class="k">%&gt;</span>

<span class="nt">&lt;br/&gt;</span>

<span class="k">&lt;%!</span>
<span class="c1">// 成员变量</span>
<span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span><span class="o">;</span>

<span class="c1">// 成员方法</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">getValue</span><span class="o">(){</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;hi&quot;</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">%&gt;</span>

<span class="k">&lt;%</span> <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span> <span class="o">//</span> <span class="n">局部变量</span> <span class="k">%&gt;</span>

访问局部变量:
<span class="k">&lt;%=</span><span class="n">a</span><span class="k">%&gt;</span>

访问成员变量:
<span class="k">&lt;%=this</span><span class="o">.</span><span class="na">a</span><span class="k">%&gt;</span>

<span class="k">&lt;%</span>
<span class="c1">// 调用成员方法</span>
<span class="n">getValue</span><span class="o">();</span>
<span class="k">%&gt;</span>

列表循环
<span class="nt">&lt;ol&gt;</span>
<span class="k">&lt;%</span> <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span> <span class="k">%&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="k">&lt;%=</span><span class="n">i</span><span class="k">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="k">&lt;%</span> <span class="o">}</span> <span class="k">%&gt;</span>
<span class="nt">&lt;/ol&gt;</span>
</pre></div>


<h2 id="3-jsp-servlet">课时 3 JSP 和 Servlet 分工的案例</h2>
<p>计算器示例</p>
<ol>
<li>获取表单数据 form.jsp</li>
<li>把字符串转换成 int 类型</li>
<li>进行加法运算得到结果</li>
<li>保存数据结果到 request 中</li>
<li>转发到 result.jsp</li>
</ol>
<p>处理流程</p>
<div class="codehilite"><pre><span></span><span class="n">form</span><span class="p">.</span><span class="n">jsp</span> <span class="o">-&gt;</span> <span class="n">servlet</span> <span class="o">-&gt;</span>  <span class="k">result</span><span class="p">.</span><span class="n">jsp</span>
</pre></div>


<p>代码文件</p>
<p>form.jsp</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;calculate&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;num1&quot;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;num2&quot;</span> <span class="p">/&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>


<p>CalculateServlet.java</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.pengshiyu.servlet</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServlet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CalculateServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doPost</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="c1">// 获取参数</span>
        <span class="n">String</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;num1&quot;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;num2&quot;</span><span class="o">);</span>

        <span class="c1">// 类型转换</span>
        <span class="kt">int</span> <span class="n">num1</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">s1</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">num2</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">s2</span><span class="o">);</span>

        <span class="c1">// 求和</span>
        <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span><span class="o">;</span>

        <span class="c1">// 赋值</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;result&quot;</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>

        <span class="c1">// 转发</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">&quot;/result.jsp&quot;</span><span class="o">).</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>result.jsp</p>
<div class="codehilite"><pre><span></span><span class="k">&lt;%=</span><span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;result&quot;</span><span class="o">)</span><span class="k">%&gt;</span>
</pre></div>


<h2 id="4-jsp">课时 4 JSP 的原理</h2>
<p>jsp 是一个特殊的 servlet</p>
<p>第一次访问 jsp 页面时，服务器会把 jsp 编译成 java 文件，一个 servlet 类<br />
再把.java 文件编译成.class 文件<br />
创建该类对象<br />
最后调用它的 service()方法</p>
<p>第二次访问同一个 jsp 页面时，直接调用 service()方法</p>
<p>流程图</p>
<div class="codehilite"><pre><span></span><span class="err">第一次访问：</span>
<span class="err">客户端</span> <span class="o">-&gt;</span> <span class="err">服务器</span> <span class="o">-&gt;</span> <span class="n">jsp</span> <span class="o">-&gt;</span> <span class="n">java</span> <span class="o">-&gt;</span> <span class="k">class</span> <span class="o">-&gt;</span> <span class="err">创建</span><span class="n">Servlet对象</span> <span class="o">-&gt;</span> <span class="err">调用</span><span class="n">service</span><span class="p">()</span><span class="err">方法</span>

<span class="err">第二次之后访问：</span>
<span class="err">客户端</span> <span class="o">-&gt;</span> <span class="err">服务器</span> <span class="o">-&gt;</span> <span class="n">jsp</span> <span class="o">-&gt;</span> <span class="err">调用</span><span class="n">service</span><span class="p">()</span><span class="err">方法</span>
</pre></div>


<p>jsp 编译为 java 类</p>
<div class="codehilite"><pre><span></span><span class="x">        jsp                 java类</span>
<span class="x">===============================================</span>
<span class="x">头                          定义9个内置对象</span>
<span class="x">                            为9个内置对象赋值</span>
<span class="x">===============================================</span>

<span class="x">体</span>
<span class="x">    html                   out.write()</span>
<span class="x">    </span><span class="cp">&lt;%</span> <span class="cp">%&gt;</span><span class="x">                  原样搬运</span>
<span class="x">    </span><span class="cp">&lt;%=%&gt;</span><span class="x">                  out.print()</span>
<span class="x">    </span><span class="cp">&lt;%</span><span class="o">!</span><span class="cp">%&gt;</span><span class="x">                  声明成员</span>
<span class="x">    </span><span class="cp">&lt;%-</span><span class="o">-</span> <span class="o">-</span><span class="cp">-%&gt;</span><span class="x">              注释不做翻译</span>
<span class="x">===============================================</span>
<span class="x">尾                         做异常处理</span>
</pre></div>


<h2 id="5-jsp">课时 5 JSP 中的注释</h2>
<div class="codehilite"><pre><span></span><span class="x">&lt;!-- --&gt;   html注释</span>
<span class="cp">&lt;%-</span><span class="o">-</span> <span class="o">-</span><span class="cp">-%&gt;</span><span class="x">  jsp注释，不会输出到html文件中</span>
</pre></div>


<h1 id="2-cookie">第 2 章 ： Cookie 处理</h1>
<h2 id="6-cookie">课时 6 Cookie 入门</h2>
<p>Cookie 是 http 协议</p>
<p>由服务器创建保存到客户端浏览器的一个键值对<br />
服务器响应头</p>
<div class="codehilite"><pre><span></span><span class="nt">Set-Cookie</span><span class="o">:</span> <span class="nt">key1</span><span class="o">=</span><span class="nt">value1</span><span class="o">;</span> <span class="nt">key2</span><span class="o">=</span><span class="nt">valu2</span>
</pre></div>


<p>客户端浏览器下次请求时会带上 Cookie<br />
客户端请求头</p>
<div class="codehilite"><pre><span></span><span class="n">Cookie</span><span class="o">:</span> <span class="n">key1</span><span class="o">=</span><span class="n">value1</span><span class="o">;</span> <span class="n">key2</span><span class="o">=</span><span class="n">valu2</span>
</pre></div>


<p>规定：</p>
<ol>
<li>1 个 Cookie 最大 4kb</li>
<li>一个服务器最多给一个浏览器 20 个 cookie</li>
<li>一个浏览器最多保存 300 个 cookie</li>
</ol>
<p>用途：<br />
服务器跟踪客户端状态<br />
购物车</p>
<p>JavaWeb 中使用：</p>
<div class="codehilite"><pre><span></span><span class="err">（</span><span class="mi">1</span><span class="err">）原始方法</span>
<span class="n">response发送Set</span><span class="o">-</span><span class="n">Cookie响应头</span>
<span class="n">request获取Cookie请求头</span>

<span class="err">（</span><span class="mi">2</span><span class="err">）便捷方法</span>
<span class="n">response</span><span class="p">.</span><span class="n">addCookie</span><span class="p">()</span>
<span class="n">request</span><span class="p">.</span><span class="n">getCookies</span><span class="p">()</span>
</pre></div>


<p>示例<br />
setCookie.jsp</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;h2&gt;</span>设置Cookie<span class="nt">&lt;/h2&gt;</span>
<span class="k">&lt;%</span>
<span class="n">Cookie</span> <span class="n">cookie</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cookie</span><span class="o">(</span><span class="s">&quot;key&quot;</span><span class="o">,</span> <span class="s">&quot;value&quot;</span><span class="o">);</span>
<span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">cookie</span><span class="o">);</span>
<span class="k">%&gt;</span>
</pre></div>


<p>getCookie.jsp</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;h2&gt;</span>获取Cookie<span class="nt">&lt;/h2&gt;</span>
<span class="k">&lt;%</span>
<span class="n">Cookie</span><span class="o">[]</span> <span class="n">cookies</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getCookies</span><span class="o">();</span>

<span class="k">if</span><span class="o">(</span><span class="n">cookies</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
    <span class="k">for</span><span class="o">(</span><span class="n">Cookie</span> <span class="n">c</span><span class="o">:</span> <span class="n">cookies</span><span class="o">){</span>
        <span class="n">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span><span class="o">+</span> <span class="n">c</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="k">%&gt;</span>
</pre></div>


<h2 id="7-cookie">课时 7 Cookie 的生命</h2>
<p>maxAge：Cookie 保存的最大时间，以秒为单位</p>
<div class="codehilite"><pre><span></span><span class="n">maxAge</span><span class="o">&gt;</span><span class="mi">0</span> <span class="err">会保存到客户端硬盘</span>
<span class="n">maxAge</span><span class="o">&lt;</span><span class="mi">0</span> <span class="err">只会在内存中，浏览器关闭就删除</span>
<span class="n">maxAge</span><span class="o">=</span><span class="mi">0</span> <span class="err">删除</span><span class="n">cookie</span>

<span class="n">eg</span><span class="p">:</span>
<span class="n">cookie</span><span class="p">.</span><span class="n">setMaxAge</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>


<h2 id="8-cookie">课时 8 Cookie 的路径</h2>
<p>path 设置需要归还的 cookie 作用域<br />
默认值为当前路径的父级目录</p>
<div class="codehilite"><pre><span></span><span class="n">eg</span><span class="o">:</span>
<span class="n">cookie</span><span class="o">.</span><span class="na">setPath</span><span class="o">(</span><span class="s1">&#39;/&#39;</span><span class="o">)</span>

<span class="n">eg</span><span class="o">:</span>
<span class="n">cookieA</span> <span class="o">/</span><span class="n">demo</span>
<span class="n">cookieB</span> <span class="sr">/demo/jsp/</span>
<span class="n">cookieC</span> <span class="sr">/demo/jsp/html/</span>

<span class="sr">/demo/i</span><span class="n">ndex</span><span class="o">.</span><span class="na">jsp</span> <span class="o">-&gt;</span> <span class="n">cookieA</span>
<span class="sr">/demo/jsp/i</span><span class="n">ndex</span><span class="o">.</span><span class="na">jsp</span> <span class="o">-&gt;</span> <span class="n">cookieA</span><span class="err">、</span><span class="n">cookieB</span>
<span class="sr">/demo/jsp/html/i</span><span class="n">ndex</span><span class="o">.</span><span class="na">jsp</span> <span class="o">-&gt;</span> <span class="n">cookieA</span><span class="err">、</span><span class="n">cookieB</span><span class="err">、</span><span class="n">cookieC</span>
</pre></div>


<h2 id="9-cookie">课时 9 Cookie 的域</h2>
<p>domain 指定共享域名</p>
<div class="codehilite"><pre><span></span><span class="n">eg</span><span class="o">:</span>
<span class="n">cookie</span><span class="o">.</span><span class="na">setDomain</span><span class="o">(</span><span class="s1">&#39;.baidu.com&#39;</span><span class="o">)</span>
<span class="n">cookie</span><span class="o">.</span><span class="na">setPath</span><span class="o">(</span><span class="s1">&#39;/&#39;</span><span class="o">)</span>

<span class="err">共享：</span><span class="n">www</span><span class="o">.</span><span class="na">baidu</span><span class="o">.</span><span class="na">com</span><span class="err">、</span><span class="n">zhidao</span><span class="o">.</span><span class="na">baidu</span><span class="o">.</span><span class="na">com</span>
</pre></div>


<h1 id="3-httpsession">第 3 章 ： HttpSession</h1>
<h2 id="10-httpsession">课时 10 HttpSession 入门</h2>
<p>HttpSession 用于会话跟踪，保存在服务器端</p>
<p>1、Servlet 三大域对象:</p>
<ol>
<li>request</li>
<li>session</li>
<li>application</li>
</ol>
<p>2、HttpSession 底层依赖:<br />
Cookie 或是 Url 重写</p>
<p>3、会话范围<br />
用户首次访问服务器开始，到该用户关闭浏览器结束</p>
<p>4、Servlet 中获取 session</p>
<div class="codehilite"><pre><span></span><span class="n">HttpSession</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">()</span>
</pre></div>


<p>5、jsp 中的 session 是内置对象，可以直接使用</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;%</span>
<span class="n">void</span> <span class="n">session</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="nb">String</span> <span class="nb">name</span><span class="p">,</span> <span class="nb">String</span> <span class="n">value</span><span class="p">);</span>
<span class="no">Object</span> <span class="n">session</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="nb">String</span> <span class="nb">name</span><span class="p">);</span>
<span class="n">void</span> <span class="n">session</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="nb">String</span> <span class="nb">name</span><span class="p">);</span>
<span class="cp">%&gt;</span><span class="x"></span>
</pre></div>


<h2 id="11-12-httpsession">课时 11-12 HttpSession 第一例</h2>
<p>创建和获取 session</p>
<p>setSession.jsp 创建 session</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;h2&gt;</span>设置Session<span class="nt">&lt;/h2&gt;</span>
<span class="k">&lt;%</span>
<span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Tom&quot;</span><span class="o">);</span>
<span class="k">%&gt;</span>
</pre></div>


<p>getSession.jsp 获取 session</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;h2&gt;</span>获取Session<span class="nt">&lt;/h2&gt;</span>

<span class="k">&lt;%=</span><span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span><span class="k">%&gt;</span>
</pre></div>


<h2 id="13-httpsession">课时 13 HttpSession 第二例</h2>
<p>登录</p>
<p>思路</p>
<div class="codehilite"><pre><span></span><span class="n">login</span><span class="p">.</span><span class="n">jsp</span>
<span class="o">-&gt;</span> <span class="n">LoginServlet</span> <span class="err">登录失败跳转回</span> <span class="n">login</span><span class="p">.</span><span class="n">jsp</span>
<span class="o">-&gt;</span> <span class="k">admin</span><span class="p">.</span><span class="n">jsp</span>    <span class="err">未登录跳转回</span> <span class="n">login</span><span class="p">.</span><span class="n">jsp</span>
</pre></div>


<p>使用 session 关闭浏览器后就消失</p>
<p>可以使用 cookie 设置保存时长，持久化到浏览器中</p>
<p>login.jsp</p>
<div class="codehilite"><pre><span></span><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span> <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="k">%&gt;</span>

<span class="k">&lt;%</span>
<span class="c1">// 如果有msg就显示</span>
<span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;msg&quot;</span><span class="o">);</span>
<span class="k">if</span><span class="o">(</span><span class="n">msg</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
<span class="o">}</span>
<span class="k">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>登录<span class="nt">&lt;/h2&gt;</span>

<span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;color: red&quot;</span><span class="nt">&gt;</span><span class="k">&lt;%=</span><span class="n">msg</span><span class="k">%&gt;</span><span class="nt">&lt;/div&gt;</span>

<span class="k">&lt;%</span>
  <span class="c1">// 清空session中的msg</span>
  <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&quot;msg&quot;</span><span class="o">);</span>
<span class="k">%&gt;</span>

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;/demo/login&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;&lt;br/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;&lt;br/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>


<p>LoginServlet.java</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.pengshiyu.servlet</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doPost</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;username&quot;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;password&quot;</span><span class="o">);</span>
        <span class="n">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>

        <span class="k">if</span> <span class="o">(</span><span class="s">&quot;admin&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">username</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;123456&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">password</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;username&quot;</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>

            <span class="c1">// 添加Cookie</span>
            <span class="n">Cookie</span> <span class="n">cookie</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cookie</span><span class="o">(</span><span class="s">&quot;username&quot;</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>
            <span class="n">cookie</span><span class="o">.</span><span class="na">setMaxAge</span><span class="o">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="o">);</span> <span class="c1">// 保存一天</span>
            <span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">cookie</span><span class="o">);</span>

            <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&quot;session/admin.jsp&quot;</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;msg&quot;</span><span class="o">,</span> <span class="s">&quot;账号或密码不正确&quot;</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&quot;session/login.jsp&quot;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>admin.jsp</p>
<div class="codehilite"><pre><span></span><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span> <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="k">%&gt;</span>

<span class="k">&lt;%</span>
<span class="c1">// 从session中获取</span>
<span class="c1">// String username =(String)session.getAttribute(&quot;username&quot;);</span>

<span class="c1">// 从cookie中获取</span>
<span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="n">Cookie</span><span class="o">[]</span> <span class="n">cookies</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getCookies</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Cookie</span> <span class="n">c</span> <span class="o">:</span><span class="n">cookies</span><span class="o">){</span>
    <span class="k">if</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;username&quot;</span><span class="o">)){</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
        <span class="k">break</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="k">if</span><span class="o">(</span><span class="n">username</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
    <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;msg&quot;</span><span class="o">,</span> <span class="s">&quot;用户未登录&quot;</span><span class="o">);</span>
    <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&quot;login.jsp&quot;</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>欢迎<span class="k">&lt;%=</span><span class="n">username</span><span class="k">%&gt;</span><span class="nt">&lt;/h2&gt;</span>
</pre></div>


<h2 id="14-httpsession">课时 14 HttpSession 原理</h2>
<p>sessionId 保存到 cookie 中</p>
<div class="codehilite"><pre><span></span><span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span> <span class="c1">// 不会创建sessionId</span>
<span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>  <span class="c1">// 会创建sessionId</span>
<span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">()</span>      <span class="c1">// 会创建sessionId</span>
</pre></div>


<h2 id="15-session">课时 15 配置 session 最大不活动时间</h2>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HttpSession</span> <span class="o">{</span>
    <span class="kt">long</span> <span class="nf">getCreationTime</span><span class="o">();</span>

    <span class="n">String</span> <span class="nf">getId</span><span class="o">();</span>  <span class="c1">// 获取sessionId</span>

    <span class="kt">long</span> <span class="nf">getLastAccessedTime</span><span class="o">();</span>

    <span class="n">ServletContext</span> <span class="nf">getServletContext</span><span class="o">();</span>

    <span class="c1">// 设置最大不活动时间，默认30分钟</span>
    <span class="kt">void</span> <span class="nf">setMaxInactiveInterval</span><span class="o">(</span><span class="kt">int</span> <span class="n">var1</span><span class="o">);</span>

    <span class="kt">int</span> <span class="nf">getMaxInactiveInterval</span><span class="o">();</span>

    <span class="c1">// 让session失效</span>
    <span class="kt">void</span> <span class="nf">invalidate</span><span class="o">();</span>

    <span class="c1">// 查看是否为新的，判断客户端第一次请求</span>
    <span class="kt">boolean</span> <span class="nf">isNew</span><span class="o">();</span>


    <span class="n">Enumeration</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getAttributeNames</span><span class="o">();</span>
    <span class="n">Object</span> <span class="nf">getAttribute</span><span class="o">(</span><span class="n">String</span> <span class="n">var1</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">setAttribute</span><span class="o">(</span><span class="n">String</span> <span class="n">var1</span><span class="o">,</span> <span class="n">Object</span> <span class="n">var2</span><span class="o">);</span>
    <span class="kt">void</span> <span class="nf">removeAttribute</span><span class="o">(</span><span class="n">String</span> <span class="n">var1</span><span class="o">);</span>

<span class="o">}</span>
</pre></div>


<p>web.xml 中配置 session 最大不活动时间</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;session-config&gt;</span>
    <span class="c">&lt;!-- 单位：分钟 --&gt;</span>
    <span class="nt">&lt;session-timeout&gt;</span>30<span class="nt">&lt;/session-timeout&gt;</span>
<span class="nt">&lt;/session-config&gt;</span>
</pre></div>


<h2 id="16-session-url">课时 16 session 之 url 重写</h2>
<p>如果浏览器的 cookie 被禁用了，可以将 sessionId 在 url 参数中传递</p>
<div class="codehilite"><pre><span></span><span class="c1">// 如果cookie中没有会加到url上</span>
<span class="n">response</span><span class="o">.</span><span class="na">encodeURL</span><span class="o">()</span>
</pre></div>


<h1 id="4">第 4 章 ： 验证码</h1>
<h2 id="17-verfiycode">课时 17 生成图片(VerfiyCode 类)</h2>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.imageio.ImageIO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.image.BufferedImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ImageUtil</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="c1">// 创建图片缓冲区</span>
        <span class="n">BufferedImage</span> <span class="n">bi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedImage</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="n">BufferedImage</span><span class="o">.</span><span class="na">TYPE_3BYTE_BGR</span><span class="o">);</span>
        <span class="c1">// 得到绘制环境</span>
        <span class="n">Graphics2D</span> <span class="n">g</span> <span class="o">=</span> <span class="o">(</span><span class="n">Graphics2D</span><span class="o">)</span> <span class="n">bi</span><span class="o">.</span><span class="na">getGraphics</span><span class="o">();</span>
        <span class="c1">// 设置白色</span>
        <span class="n">g</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">WHITE</span><span class="o">);</span>
        <span class="c1">// 绘制矩形，相当于绘制背景色</span>
        <span class="n">g</span><span class="o">.</span><span class="na">fillRect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="mi">50</span><span class="o">);</span>
        <span class="c1">// 设置红色</span>
        <span class="n">g</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">RED</span><span class="o">);</span>
        <span class="c1">// 写字</span>
        <span class="n">g</span><span class="o">.</span><span class="na">drawString</span><span class="o">(</span><span class="s">&quot;hello&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">35</span><span class="o">);</span>
        <span class="c1">// 保存输出</span>
        <span class="n">ImageIO</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bi</span><span class="o">,</span> <span class="s">&quot;JPEG&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="s">&quot;1.jpg&quot;</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>结合登录验证的完整代码</p>
<div class="codehilite"><pre><span></span><span class="n">login</span><span class="p">.</span><span class="n">jsp</span><span class="p">(</span><span class="n">VerifyCodeServlet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LoginServlet</span> <span class="o">-&gt;</span> <span class="k">admin</span><span class="p">.</span><span class="n">jsp</span>
</pre></div>


<p>login.jsp</p>
<div class="codehilite"><pre><span></span><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span> <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="k">%&gt;</span>

<span class="k">&lt;%</span>
<span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;msg&quot;</span><span class="o">);</span>
<span class="k">if</span><span class="o">(</span><span class="n">msg</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
<span class="o">}</span>
<span class="k">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>登录<span class="nt">&lt;/h2&gt;</span>

<span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">&quot;color: red&quot;</span><span class="nt">&gt;</span><span class="k">&lt;%=</span><span class="n">msg</span><span class="k">%&gt;</span><span class="nt">&lt;/div&gt;</span>

<span class="k">&lt;%</span>
  <span class="c1">// 清空session</span>
  <span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">&quot;msg&quot;</span><span class="o">);</span>
<span class="k">%&gt;</span>

<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;/demo/login&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
    用户名：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;&lt;br/&gt;</span>
    密码：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;&lt;br/&gt;</span>
    验证码：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;verify_code&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;/demo/code&quot;</span> <span class="na">id=</span><span class="s">&quot;code&quot;</span><span class="nt">&gt;</span>  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;javascript:changeImage()&quot;</span><span class="nt">&gt;</span>换一张<span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;br/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/form&gt;</span>

<span class="nt">&lt;script&gt;</span>
function changeImage(){
    let code = document.getElementById(&quot;code&quot;);
    code.src = &quot;/demo/code?&quot; + new Date().getTime();
}
<span class="nt">&lt;/script&gt;</span>
</pre></div>


<p>admin.jsp</p>
<div class="codehilite"><pre><span></span><span class="k">&lt;%@</span> <span class="n">page</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span> <span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span> <span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="k">%&gt;</span>

<span class="k">&lt;%</span>
<span class="c1">// 从session中获取</span>
<span class="c1">// String username =(String)session.getAttribute(&quot;username&quot;);</span>

<span class="c1">// 从cookie中获取</span>
<span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="n">Cookie</span><span class="o">[]</span> <span class="n">cookies</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getCookies</span><span class="o">();</span>
<span class="k">if</span><span class="o">(</span><span class="n">cookies</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Cookie</span> <span class="n">c</span> <span class="o">:</span><span class="n">cookies</span><span class="o">){</span>
        <span class="k">if</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;username&quot;</span><span class="o">)){</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
            <span class="k">break</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="k">if</span><span class="o">(</span><span class="n">username</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
    <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;msg&quot;</span><span class="o">,</span> <span class="s">&quot;用户未登录&quot;</span><span class="o">);</span>
    <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&quot;login.jsp&quot;</span><span class="o">);</span>
<span class="o">}</span>
<span class="k">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>欢迎<span class="k">&lt;%=</span><span class="n">username</span><span class="k">%&gt;</span><span class="nt">&lt;/h2&gt;</span>
</pre></div>


<p>LoginServlet.java</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.pengshiyu.servlet</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doPost</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;username&quot;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;password&quot;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">verifyCode</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;verify_code&quot;</span><span class="o">);</span>

        <span class="n">HttpSession</span> <span class="n">session</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">code</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&quot;code&quot;</span><span class="o">);</span>

        <span class="c1">// 验证码校验</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">code</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">verifyCode</span><span class="o">)){</span>
            <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;msg&quot;</span><span class="o">,</span> <span class="s">&quot;验证码不正确&quot;</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&quot;session/login.jsp&quot;</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="s">&quot;admin&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">username</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="s">&quot;123456&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">password</span><span class="o">))</span> <span class="o">{</span>

            <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;username&quot;</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>

            <span class="c1">// 添加Cookie</span>
            <span class="n">Cookie</span> <span class="n">cookie</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Cookie</span><span class="o">(</span><span class="s">&quot;username&quot;</span><span class="o">,</span> <span class="n">username</span><span class="o">);</span>
            <span class="n">cookie</span><span class="o">.</span><span class="na">setMaxAge</span><span class="o">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="o">);</span> <span class="c1">// 保存一天</span>
            <span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">cookie</span><span class="o">);</span>

            <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&quot;session/admin.jsp&quot;</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;msg&quot;</span><span class="o">,</span> <span class="s">&quot;账号或密码不正确&quot;</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">&quot;session/login.jsp&quot;</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>VerifyCodeServlet.java</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.pengshiyu.servlet</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">util.ImageUtil</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServlet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VerifyCodeServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">code</span> <span class="o">=</span> <span class="n">ImageUtil</span><span class="o">.</span><span class="na">getVerifyCode</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>
        <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;code&quot;</span><span class="o">,</span> <span class="n">code</span><span class="o">);</span>
        <span class="n">ImageUtil</span><span class="o">.</span><span class="na">writeImage</span><span class="o">(</span><span class="n">code</span><span class="o">,</span> <span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>ImageUtil.java</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.imageio.ImageIO</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.image.BufferedImage</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ImageUtil</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">writeImage</span><span class="o">(</span><span class="n">String</span> <span class="n">text</span><span class="o">,</span> <span class="n">OutputStream</span> <span class="n">output</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="c1">// 创建图片缓冲区</span>
        <span class="n">BufferedImage</span> <span class="n">bi</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedImage</span><span class="o">(</span><span class="mi">50</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="n">BufferedImage</span><span class="o">.</span><span class="na">TYPE_3BYTE_BGR</span><span class="o">);</span>
        <span class="c1">// 得到绘制环境</span>
        <span class="n">Graphics2D</span> <span class="n">g</span> <span class="o">=</span> <span class="o">(</span><span class="n">Graphics2D</span><span class="o">)</span> <span class="n">bi</span><span class="o">.</span><span class="na">getGraphics</span><span class="o">();</span>
        <span class="c1">// 设置白色</span>
        <span class="n">g</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">WHITE</span><span class="o">);</span>
        <span class="c1">// 绘制矩形，相当于绘制背景色</span>
        <span class="n">g</span><span class="o">.</span><span class="na">fillRect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="mi">20</span><span class="o">);</span>
        <span class="c1">// 设置红色</span>
        <span class="n">g</span><span class="o">.</span><span class="na">setColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">RED</span><span class="o">);</span>
        <span class="c1">// 写字</span>
        <span class="n">g</span><span class="o">.</span><span class="na">drawString</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">16</span><span class="o">);</span>
        <span class="c1">// 保存输出</span>
        <span class="n">ImageIO</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bi</span><span class="o">,</span> <span class="s">&quot;JPEG&quot;</span><span class="o">,</span> <span class="n">output</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getVerifyCode</span><span class="o">(</span><span class="kt">int</span> <span class="n">length</span><span class="o">){</span>
        <span class="n">String</span> <span class="n">code</span>  <span class="o">=</span> <span class="s">&quot;1234567890&quot;</span><span class="o">;</span>
        <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>

        <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">();</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="o">;</span> <span class="n">i</span> <span class="o">++){</span>
            <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">code</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
            <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">code</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">index</span><span class="o">,</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>

    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">ImageUtil</span><span class="o">.</span><span class="na">writeImage</span><span class="o">(</span><span class="n">ImageUtil</span><span class="o">.</span><span class="na">getVerifyCode</span><span class="o">(</span><span class="mi">4</span><span class="o">),</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="s">&quot;1.jpg&quot;</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h1 id="5-jsp_1">第 5 章 ： JSP 指令</h1>
<h2 id="19-page">课时 19 page 指令</h2>
<p>page</p>
<ol>
<li>include 静态包含</li>
<li>taglib 导入标签库</li>
</ol>
<p>指令格式</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;%</span><span class="err">@指令名</span> <span class="n">attr1</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="n">attr2</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="cp">%&gt;</span><span class="x"></span>
</pre></div>


<p>一般放在文件最上方，可以有多个</p>
<p>page</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;%</span><span class="vi">@page</span>
<span class="n">language</span><span class="o">=</span><span class="s2">&quot;java&quot;</span>
<span class="n">import</span><span class="o">=</span><span class="s2">&quot;java.util.*,java.net.*&quot;</span>
<span class="n">pageEncoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span>
<span class="n">contentType</span><span class="o">=</span><span class="s2">&quot;text/html; charset=utf-8&quot;</span>
<span class="n">errorPage</span><span class="o">=</span><span class="s2">&quot;errorPage.jsp&quot;</span>
<span class="cp">%&gt;</span><span class="x"></span>
</pre></div>


<p>pageEncoding 指定页面编码<br />
contentType 响应头<br />
如果两个参数只有一个，那么默认为设置的那个<br />
如果两个参数都没有设置，那么默认为 iso</p>
<p>import 导包，可以出现多次<br />
errorPage 页面出错跳转<br />
isErrorPage="true" 是否为处理错误的页面，会设置状态码为 500,可以使用 exception<br />
eg:</p>
<div class="codehilite"><pre><span></span><span class="n">exception</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">());</span>
</pre></div>


<p>web.xml 配置错误页面</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;error-page&gt;</span>
    <span class="nt">&lt;error-code&gt;</span>404<span class="nt">&lt;/error-code&gt;</span>
    <span class="nt">&lt;location&gt;</span>/error404.jsp<span class="nt">&lt;/location&gt;</span>
<span class="nt">&lt;/error-page&gt;</span>

<span class="nt">&lt;error-page&gt;</span>
    <span class="nt">&lt;error-code&gt;</span>500<span class="nt">&lt;/error-code&gt;</span>
    <span class="nt">&lt;location&gt;</span>/error500.jsp<span class="nt">&lt;/location&gt;</span>
<span class="nt">&lt;/error-page&gt;</span>

<span class="nt">&lt;error-page&gt;</span>
    <span class="nt">&lt;excepiton-type&gt;</span>java.lang.RuntimeException<span class="nt">&lt;/excepiton-type&gt;</span>
    <span class="nt">&lt;location&gt;</span>/error.jsp<span class="nt">&lt;/location&gt;</span>
<span class="nt">&lt;/error-page&gt;</span>
</pre></div>


<p>autoFlush 指定缓冲区满时是否自动刷新</p>
<p>buffer 缓冲区大小，默认 8kb</p>
<p>isELIgnored 是否忽略 EL 表达式，默认为 false，不忽略</p>
<p>基本不用</p>
<p>language 指定当前 jsp 编译后的语言类型，默认为 java</p>
<p>extends 指定当前页面生成 Servlet 的父类</p>
<p>isThreadSafe 是否支持并发访问 默认为 false，为 true 已过时</p>
<p>info 信息</p>
<p>session 是否支持 session，如果为 false，就没有 session 对象</p>
<h2 id="20-pagecontext">课时 20 pageContext 对象</h2>
<p>9 大内置对象</p>
<ol>
<li>out JspWriter response.getWriter() 发送文本数据</li>
<li>config ServletConfig this.ServletConfig</li>
<li>page this,当前 jsp 对象</li>
<li>pageContext 页面上下文对象 一个顶 9 个</li>
<li>exception 只有在错误页面中使用</li>
<li>request HttpServletRequest</li>
<li>response HttpServletResponse</li>
<li>application ServletContext</li>
<li>session HttpSession</li>
</ol>
<p>Servlet 中有大个域对象，</p>
<p>JSP 中有四个域对象：</p>
<ol>
<li>ServletContext 整个应用程序</li>
<li>session 整个会话，一个会话中只有一个用户</li>
<li>request 一个请求链</li>
<li>pageContext 一个 jsp 页面，当前页面标签之间共享数据</li>
</ol>
<div class="codehilite"><pre><span></span><span class="c1">// 代理其他域对象</span>
<span class="n">pageContext</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&quot;key&quot;</span><span class="o">,</span> <span class="s">&quot;value&quot;</span><span class="o">,</span> <span class="n">PageContext</span><span class="o">.</span><span class="na">SESSION_SCOPE</span><span class="o">)</span>

<span class="c1">// 全域查找，从小到大page、request、response、application</span>
<span class="n">pageContext</span><span class="o">.</span><span class="na">findAttribute</span><span class="o">(</span><span class="s">&quot;key&quot;</span><span class="o">);</span>

<span class="c1">// 获取其他内置对象</span>
</pre></div>


<h2 id="21-include-taglib">课时 21 include 和 taglib 指令</h2>
<p>1、include 静态包含 jsp 编译成 java 文件时完成</p>
<div class="codehilite"><pre><span></span><span class="o">&lt;%</span>@<span class="k">include</span> <span class="nv">file</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">demo.jsp</span><span class="s2">&quot;</span> <span class="o">%&gt;</span>
</pre></div>


<p>2、tablib 导入标签库</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;%</span><span class="vi">@taglib</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;s&quot;</span> <span class="n">uri</span><span class="o">=</span><span class="s2">&quot;/tags&quot;</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">&lt;s:text&gt;</span>
</pre></div>


<p>prefix 指定标签库前缀<br />
uri 指定标签库位置</p>
<h1 id="6-jsp">第 6 章 ： JSP 动作标签</h1>
<h2 id="22-jsp">课时 22 JSP 动作标签</h2>
<ol>
<li><code>&lt;jsp:forword&gt;</code> 转发 RequestDispatcher.forword</li>
<li><code>&lt;jsp:include&gt;</code> 包含 RequestDispatcher.include</li>
<li><code>&lt;jsp:param&gt;</code> 传递参数</li>
</ol>
<p>a.jsp 动态包含 b.jsp，并传递参数</p>
<div class="codehilite"><pre><span></span><span class="k">&lt;jsp:forward page=&quot;b.jsp&quot;&gt;</span>
    <span class="nt">&lt;jsp:param</span> <span class="na">name=</span><span class="s">&quot;key1&quot;</span> <span class="na">value=</span><span class="s">&quot;value1&quot;</span><span class="nt">&gt;&lt;/jsp:param&gt;</span>
    <span class="nt">&lt;jsp:param</span> <span class="na">name=</span><span class="s">&quot;key2&quot;</span> <span class="na">value=</span><span class="s">&quot;value2&quot;</span><span class="nt">&gt;&lt;/jsp:param&gt;</span>
<span class="k">&lt;/jsp:forward&gt;</span>
</pre></div>


<p>b.jsp</p>
<div class="codehilite"><pre><span></span><span class="k">&lt;%=</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;key1&quot;</span><span class="o">)</span><span class="k">%&gt;</span>
<span class="k">&lt;%=</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;key2&quot;</span><span class="o">)</span><span class="k">%&gt;</span>
</pre></div>


<h2 id="23-jsp-webxml">课时 23 JSP 在 web.xml 中也可以配置</h2>
<p>开发自动重启<br />
tomcat/conf/context.xml</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;Context</span> <span class="na">reloadable=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>

<span class="nt">&lt;/Context&gt;</span>
</pre></div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            2019-2020
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/mouday" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../assets/javascripts/lunr/lunr.ja.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>