



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="ja">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Java笔记：SpringBoot开发常用技术整合 - 学习笔记</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#javaspringboot" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="学习笔记" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              学习笔记
            </span>
            <span class="md-header-nav__topic">
              
                Java笔记：SpringBoot开发常用技术整合
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="学习笔记" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    学习笔记
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="主页" class="md-nav__link">
      主页
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../php/" title="PHP" class="md-nav__link">
      PHP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../ElasticSearch/" title="ElasticSearch" class="md-nav__link">
      ElasticSearch
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../JavaScript/" title="JavaScript" class="md-nav__link">
      JavaScript
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../MySQL/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../人工智能/" title="人工智能" class="md-nav__link">
      人工智能
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../LEK/" title="LEK" class="md-nav__link">
      LEK
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../设计模式/" title="设计模式" class="md-nav__link">
      设计模式
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Linux/" title="Linux" class="md-nav__link">
      Linux
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../前端/" title="前端" class="md-nav__link">
      前端
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#springboot" class="md-nav__link">
    一、构建springboot工程
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#json" class="md-nav__link">
    二、接口返回json
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    三、热部署
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    四、资源属性配置
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    五、模板引擎
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    六、异常处理
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mybatis" class="md-nav__link">
    七、MyBatis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#redis" class="md-nav__link">
    八、redis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    九、定时任务
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    十、异步任务
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    十一、拦截器
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="javaspringboot">Java笔记：SpringBoot开发常用技术整合</h1>
<h2 id="springboot">一、构建springboot工程</h2>
<p>参考源码地址<br />
<a href="https://github.com/leechenxiang/imooc-springboot-starter">https://github.com/leechenxiang/imooc-springboot-starter</a></p>
<p>可选IDE<br />
STS Spring Tool Suit</p>
<p>快速开始：<a href="https://spring.io/quickstart">https://spring.io/quickstart</a></p>
<p>配置文件 application.properties</p>
<div class="codehilite"><pre><span></span><span class="c1">############################################################</span>
<span class="c1">#</span>
<span class="c1"># 开发模式设置</span>
<span class="c1">#</span>
<span class="c1">############################################################</span>

<span class="c1"># 热部署生效</span>
spring.devtools.restart.enabled<span class="o">=</span><span class="nb">true</span>

<span class="c1"># 监听目录</span>
spring.devtools.restart.additional-paths<span class="o">=</span>src/main/java

<span class="c1">#spring.devtools.restart.exclude=static/**,public/**</span>
<span class="c1">#spring.devtools.restart.exclude=WEB-INF/**</span>


<span class="c1">############################################################</span>
<span class="c1">#</span>
<span class="c1"># server 服务端配置</span>
<span class="c1">#</span>
<span class="c1">############################################################</span>

server.port<span class="o">=</span><span class="m">8080</span>

<span class="c1">#server.servlet.context-path=/demo</span>
<span class="c1">#server.error.path=/error</span>
<span class="c1">#server.address=192.168.1.2</span>
<span class="c1">#server.session-timeout=60</span>

<span class="c1">############################################################</span>
<span class="c1">#</span>
<span class="c1"># server.tomcat 服务端配置</span>
<span class="c1">#</span>
<span class="c1">############################################################</span>

<span class="c1">#server.tomcat.max-threads=250</span>
server.tomcat.uri-encoding<span class="o">=</span>UTF-8
<span class="c1">#server.tomcat.basedir=H:/springboot-tomcat-tmp</span>
<span class="c1">#server.tomcat.access-log-enabled=true</span>
<span class="c1">#server.tomcat.access-log-pattern=</span>
<span class="c1">#server.tomcat.accesslog.directory=</span>
<span class="c1">#logging.path=H:/springboot-tomcat-tmp</span>
<span class="c1">#logging.file=myapp.log</span>
</pre></div>


<h2 id="json">二、接口返回json</h2>
<div class="codehilite"><pre><span></span><span class="c1"># 时间格式化</span>
spring.jackson.date-format<span class="o">=</span>yyyy-MM-dd HH:mm:ss
spring.jackson.time-zone<span class="o">=</span>GMT+8
spring.jackson.serialization.write-dates-as-timestamps<span class="o">=</span><span class="nb">false</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.pojo</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * 统一的返回封装</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JsonResult</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">code</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">msg</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Object</span> <span class="n">data</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">JsonResult</span><span class="o">(</span><span class="n">Integer</span> <span class="n">code</span><span class="o">,</span> <span class="n">String</span> <span class="n">msg</span><span class="o">,</span> <span class="n">Object</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">JsonResult</span> <span class="nf">success</span><span class="o">(</span><span class="n">Object</span> <span class="n">data</span><span class="o">){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">JsonResult</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="s">&quot;success&quot;</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">JsonResult</span> <span class="nf">error</span><span class="o">(</span><span class="n">String</span> <span class="n">errorMessage</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">JsonResult</span><span class="o">(-</span><span class="mi">1</span><span class="o">,</span> <span class="n">errorMessage</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">getCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">code</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCode</span><span class="o">(</span><span class="n">Integer</span> <span class="n">code</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMsg</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMsg</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getData</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setData</span><span class="o">(</span><span class="n">Object</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.pojo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonIgnore</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonInclude</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * jackson注解使用示例</span>
<span class="cm"> */</span>
<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">age</span><span class="o">;</span>

    <span class="c1">// 忽略显示</span>
    <span class="nd">@JsonIgnore</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>

    <span class="c1">// 格式化</span>
    <span class="nd">@JsonFormat</span><span class="o">(</span><span class="n">pattern</span><span class="o">=</span><span class="s">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="o">,</span> <span class="n">locale</span><span class="o">=</span><span class="s">&quot;zh&quot;</span><span class="o">,</span> <span class="n">timezone</span><span class="o">=</span><span class="s">&quot;GMT+8&quot;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">birthday</span><span class="o">;</span>

    <span class="c1">// 为空不显示</span>
    <span class="nd">@JsonInclude</span><span class="o">(</span><span class="n">JsonInclude</span><span class="o">.</span><span class="na">Include</span><span class="o">.</span><span class="na">NON_NULL</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">desc</span><span class="o">;</span>

<span class="o">}</span>
</pre></div>


<h2 id="_1">三、热部署</h2>
<div class="codehilite"><pre><span></span><span class="c">&lt;!--热部署--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>


<p>IDEA需要做额外的配置</p>
<h2 id="_2">四、资源属性配置</h2>
<p>resource.properties</p>
<div class="codehilite"><pre><span></span><span class="c1"># 配置文件</span>
com.demo.name<span class="o">=</span>MyBlog
com.demo.language<span class="o">=</span>zh
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.pojo</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">org.springframework.boot.context.properties.ConfigurationProperties</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.PropertySource</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * 资源文件中的配置映射到实体类</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">&quot;com.demo&quot;</span><span class="o">)</span>
<span class="nd">@PropertySource</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;classpath:resource.properties&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Resource</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">language</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getLanguage</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">language</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setLanguage</span><span class="o">(</span><span class="n">String</span> <span class="n">language</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">language</span> <span class="o">=</span> <span class="n">language</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h2 id="_3">五、模板引擎</h2>
<div class="codehilite"><pre><span></span><span class="c">&lt;!--模板引擎 freemarker--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-freemarker<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!--模板引擎 thymeleaf--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-thymeleaf<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="c1">############################################################</span>
<span class="c1">#</span>
<span class="c1"># freemarker</span>
<span class="c1">#</span>
<span class="c1">############################################################</span>

<span class="c1"># 上线改为true</span>
spring.freemarker.cache<span class="o">=</span><span class="nb">false</span>
<span class="c1">#spring.freemarker.template-loader-path=classpath:/templates</span>
<span class="c1">#spring.freemarker.charset=UTF-8</span>
<span class="c1">#spring.freemarker.check-template-location=true</span>
<span class="c1">#spring.freemarker.content-type=text/html</span>
<span class="c1">#spring.freemarker.expose-request-attributes=true</span>
<span class="c1">#spring.freemarker.expose-session-attributes=true</span>
<span class="c1">#spring.freemarker.request-context-attribute=request</span>
<span class="c1">#spring.freemarker.suffix=.ftl</span>

<span class="c1">############################################################</span>
<span class="c1">#</span>
<span class="c1"># thymeleaf</span>
<span class="c1">#</span>
<span class="c1">#############################################################</span>
<span class="c1"># 上线改为true</span>
spring.thymeleaf.cache<span class="o">=</span><span class="nb">false</span>
<span class="c1">#spring.thymeleaf.prefix=classpath:/templates/</span>
<span class="c1">#spring.thymeleaf.suffix=.html</span>
<span class="c1">#spring.thymeleaf.mode=HTML5</span>
<span class="c1">#spring.thymeleaf.encoding=UTF-8</span>
<span class="c1">#spring.thymeleaf.servlet.content-type=text/html</span>

<span class="c1"># 静态文件</span>
spring.mvc.static-path-pattern<span class="o">=</span>/static/**
</pre></div>


<p>freemarker</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>freemarker<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>${resource.name}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>${resource.language}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>


<p>thymeleaf</p>
<p>基本使用方式<br />
对象引用方式<br />
时间类型转换<br />
text与utext<br />
URL<br />
引入静态资源文件js/css<br />
条件判断th:if与th:unless<br />
循环th:each<br />
分支th:switch与th:case</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span> <span class="na">xmlns:th</span><span class="o">=</span><span class="s">&quot;http://www.thymeleaf.org&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">th:src</span><span class="o">=</span><span class="s">&quot;@{/static/js/index.js}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>基本语法<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:value</span><span class="o">=</span><span class="s">&quot;${user.name}&quot;</span>  <span class="na">th:id</span><span class="o">=</span><span class="s">&quot;${user.name}&quot;</span> <span class="na">th:name</span><span class="o">=</span><span class="s">&quot;${user.name}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:value</span><span class="o">=</span><span class="s">&quot;${user.age}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:value</span><span class="o">=</span><span class="s">&quot;${user.birthday}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>日期格式化<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:value</span><span class="o">=</span><span class="s">&quot;${#dates.format(user.birthday, &#39;yyyy-MM-dd&#39;)}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>简便写法<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${user}&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:value</span><span class="o">=</span><span class="s">&quot;*{name}&quot;</span>  <span class="na">th:id</span><span class="o">=</span><span class="s">&quot;*{name}&quot;</span> <span class="na">th:name</span><span class="o">=</span><span class="s">&quot;*{name}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:value</span><span class="o">=</span><span class="s">&quot;*{age}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:value</span><span class="o">=</span><span class="s">&quot;*{birthday}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>text与utext<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>text: <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${user.desc}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>utext: <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:utext</span><span class="o">=</span><span class="s">&quot;${user.desc}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>网址<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">th:href</span><span class="o">=</span><span class="s">&quot;@{https://www.baidu.com/}&quot;</span><span class="p">&gt;</span>www.baidu.com<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>表单<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">th:action</span><span class="o">=</span><span class="s">&quot;@{/thymeleaf/user}&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">th:object</span><span class="o">=</span><span class="s">&quot;${user}&quot;</span><span class="p">&gt;</span>
    <span class="c">&lt;!-- field == id, name, value --&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">th:field</span><span class="o">=</span><span class="s">&quot;*{name}&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>判断<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${user.age} == 20&quot;</span><span class="p">&gt;</span> age == 20<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${user.age} gt 20&quot;</span><span class="p">&gt;</span> age &gt; 20<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${user.age} lt 20&quot;</span><span class="p">&gt;</span> age <span class="p">&lt;</span> <span class="nt">20</span><span class="err">&lt;/</span><span class="na">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${user.age} ge 20&quot;</span><span class="p">&gt;</span> age &gt;= 20<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:if</span><span class="o">=</span><span class="s">&quot;${user.age} le 20&quot;</span><span class="p">&gt;</span> age <span class="err">&lt;</span>= 20<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>选择框<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">select</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">option</span> <span class="na">th:selected</span><span class="o">=</span><span class="s">&quot;${user.age} == 20&quot;</span><span class="p">&gt;</span>20<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">option</span> <span class="na">th:selected</span><span class="o">=</span><span class="s">&quot;${user.age} == 18&quot;</span><span class="p">&gt;</span>18<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>循环<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:each</span><span class="o">=</span><span class="s">&quot;person:${userList}&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:text</span><span class="o">=</span><span class="s">&quot;${person.name}&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>分支<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span> <span class="na">th:switch</span><span class="o">=</span><span class="s">&quot;${user.name}&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:case</span><span class="o">=</span><span class="s">&quot;#{roles.superadmin}&quot;</span><span class="p">&gt;</span>超级管理员<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:case</span><span class="o">=</span><span class="s">&quot;#{roles.manager}&quot;</span><span class="p">&gt;</span>管理员<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">span</span> <span class="na">th:case</span><span class="o">=</span><span class="s">&quot;*&quot;</span><span class="p">&gt;</span>普通会员<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>


<h2 id="_4">六、异常处理</h2>
<p>通用异常 web和ajax</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.exception</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ControllerAdvice</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ExceptionHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ModelAndView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.view.json.MappingJackson2JsonView</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * 处理错误页面</span>
<span class="cm"> */</span>
<span class="nd">@ControllerAdvice</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomExceptionHandler</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">ERROR_VIEW</span> <span class="o">=</span> <span class="s">&quot;thymeleaf/error&quot;</span><span class="o">;</span>

    <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">errorHandler</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                               <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">isAjax</span><span class="o">(</span><span class="n">request</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">ModelAndView</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ModelAndView</span><span class="o">(</span><span class="k">new</span> <span class="n">MappingJackson2JsonView</span><span class="o">());</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">&quot;data&quot;</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">&quot;code&quot;</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">);</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">&quot;msg&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="k">return</span> <span class="n">model</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">ModelAndView</span> <span class="n">model</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ModelAndView</span><span class="o">();</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">&quot;exception&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addObject</span><span class="o">(</span><span class="s">&quot;url&quot;</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURL</span><span class="o">());</span>
            <span class="n">model</span><span class="o">.</span><span class="na">setViewName</span><span class="o">(</span><span class="n">ERROR_VIEW</span><span class="o">);</span>

            <span class="k">return</span> <span class="n">model</span><span class="o">;</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 判断是否为ajax</span>
<span class="cm">     *</span>
<span class="cm">     * @param request</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isAjax</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">ContentType</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">&quot;Content-Type&quot;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">Accept</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">&quot;Accept&quot;</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">ContentType</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span>
                <span class="n">ContentType</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;json&quot;</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">Accept</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span>
                <span class="n">Accept</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;json&quot;</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>


<span class="o">}</span>
</pre></div>


<p>处理ajax错误</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.exception</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.demo.pojo.JsonResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ExceptionHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestControllerAdvice</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * 处理ajax错误</span>
<span class="cm"> */</span>
<span class="nd">@RestControllerAdvice</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AjaxExceptionHandler</span> <span class="o">{</span>

    <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">JsonResult</span> <span class="nf">errorHandler</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                               <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

        <span class="k">return</span> <span class="n">JsonResult</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h2 id="mybatis">七、MyBatis</h2>
<p>依赖引入pom.xml</p>
<div class="codehilite"><pre><span></span><span class="c">&lt;!--数据库相关--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>8.0.20<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>druid<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.1.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>druid-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.1.9<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!--mybatis--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.3.1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!--mapper--&gt;</span>
<span class="c">&lt;!--版本过低会报错--&gt;</span>
<span class="c">&lt;!--tk.mybatis.mapper.MapperException: tk.mybatis.mapper.provider.EmptyProvider中缺少selectOne方法!--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>tk.mybatis<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>mapper-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>2.0.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="c">&lt;!--pagehelper--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.github.pagehelper<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>pagehelper-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.2.3<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.mybatis.generator<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>mybatis-generator-core<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.3.2<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>compile<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>


<p>参数配置 application.properties</p>
<div class="codehilite"><pre><span></span><span class="c1">############################################################</span>
<span class="c1">#</span>
<span class="c1"># druid</span>
<span class="c1">#</span>
<span class="c1">############################################################</span>
spring.datasource.url<span class="o">=</span>jdbc:mysql://localhost:3306/data
spring.datasource.username<span class="o">=</span>root
spring.datasource.password<span class="o">=</span><span class="m">123456</span>
spring.datasource.driver-class-name<span class="o">=</span>com.mysql.cj.jdbc.Driver
spring.datasource.druid.initial-size<span class="o">=</span><span class="m">1</span>
spring.datasource.druid.min-idle<span class="o">=</span><span class="m">1</span>
spring.datasource.druid.max-active<span class="o">=</span><span class="m">20</span>
spring.datasource.druid.test-on-borrow<span class="o">=</span><span class="nb">true</span>
<span class="c1">#spring.datasource.druid.stat-view-servlet.allow=true</span>


<span class="c1">############################################################</span>
<span class="c1">#</span>
<span class="c1"># mybatis</span>
<span class="c1"># https://github.com/abel533/MyBatis-Spring-Boot</span>
<span class="c1">############################################################</span>
mybatis.type-aliases-package<span class="o">=</span>com.example.demo.pojo
mybatis.mapper-locations<span class="o">=</span>classpath:mapper/*.xml
mybatis.configuration.log-impl<span class="o">=</span>org.apache.ibatis.logging.stdout.StdOutImpl

<span class="c1"># 通用mapper</span>
mapper.mappers<span class="o">=</span>com.example.demo.utils.MyMapper
mapper.not-empty<span class="o">=</span><span class="nb">false</span>
mapper.identity<span class="o">=</span>MYSQL

<span class="c1"># 分页插件</span>
pagehelper.helperDialect<span class="o">=</span>mysql
pagehelper.reasonable<span class="o">=</span><span class="nb">true</span>
pagehelper.supportMethodsArguments<span class="o">=</span><span class="nb">true</span>
pagehelper.params<span class="o">=</span><span class="nv">count</span><span class="o">=</span>countSql
</pre></div>


<p>自动代码生成配置 generatorConfig.xml</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE generatorConfiguration</span>
<span class="cp">        PUBLIC &quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span>
<span class="cp">        &quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;&gt;</span>

<span class="nt">&lt;generatorConfiguration&gt;</span>
    <span class="nt">&lt;context</span> <span class="na">id=</span><span class="s">&quot;MysqlContext&quot;</span> <span class="na">targetRuntime=</span><span class="s">&quot;MyBatis3Simple&quot;</span> <span class="na">defaultModelType=</span><span class="s">&quot;flat&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;beginningDelimiter&quot;</span> <span class="na">value=</span><span class="s">&quot;`&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;endingDelimiter&quot;</span> <span class="na">value=</span><span class="s">&quot;`&quot;</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;plugin</span> <span class="na">type=</span><span class="s">&quot;tk.mybatis.mapper.generator.MapperPlugin&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;mappers&quot;</span> <span class="na">value=</span><span class="s">&quot;com.example.demo.utils.MyMapper&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/plugin&gt;</span>

        <span class="nt">&lt;jdbcConnection</span> <span class="na">driverClass=</span><span class="s">&quot;com.mysql.jdbc.Driver&quot;</span>
                        <span class="na">connectionURL=</span><span class="s">&quot;jdbc:mysql://localhost:3306/data&quot;</span>
                        <span class="na">userId=</span><span class="s">&quot;root&quot;</span>
                        <span class="na">password=</span><span class="s">&quot;123456&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/jdbcConnection&gt;</span>

        <span class="c">&lt;!-- 对于生成的pojo所在包 --&gt;</span>
        <span class="nt">&lt;javaModelGenerator</span> <span class="na">targetPackage=</span><span class="s">&quot;com.example.demo.pojo&quot;</span> <span class="na">targetProject=</span><span class="s">&quot;src/main/java&quot;</span><span class="nt">/&gt;</span>

        <span class="c">&lt;!-- 对于生成的mapper所在目录 --&gt;</span>
        <span class="nt">&lt;sqlMapGenerator</span> <span class="na">targetPackage=</span><span class="s">&quot;mapper&quot;</span> <span class="na">targetProject=</span><span class="s">&quot;src/main/resources&quot;</span><span class="nt">/&gt;</span>

        <span class="c">&lt;!-- 配置mapper对应的java映射 --&gt;</span>
        <span class="nt">&lt;javaClientGenerator</span> <span class="na">targetPackage=</span><span class="s">&quot;com.example.demo.mapper&quot;</span> <span class="na">targetProject=</span><span class="s">&quot;src/main/java&quot;</span>
                             <span class="na">type=</span><span class="s">&quot;XMLMAPPER&quot;</span><span class="nt">/&gt;</span>


        <span class="nt">&lt;table</span> <span class="na">tableName=</span><span class="s">&quot;sys_user&quot;</span><span class="nt">&gt;&lt;/table&gt;</span>

    <span class="nt">&lt;/context&gt;</span>
<span class="nt">&lt;/generatorConfiguration&gt;</span>
</pre></div>


<p>逆向工程工具</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.utils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.mybatis.generator.api.MyBatisGenerator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mybatis.generator.config.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mybatis.generator.config.xml.ConfigurationParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mybatis.generator.internal.DefaultShellCallback</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GeneratorDisplay</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">generator</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">{</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">warnings</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
        <span class="kt">boolean</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="c1">// 指定 逆向工程配置文件</span>
        <span class="n">File</span> <span class="n">configFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&quot;generatorConfig.xml&quot;</span><span class="o">);</span>
        <span class="n">ConfigurationParser</span> <span class="n">cp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConfigurationParser</span><span class="o">(</span><span class="n">warnings</span><span class="o">);</span>
        <span class="n">Configuration</span> <span class="n">config</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="na">parseConfiguration</span><span class="o">(</span><span class="n">configFile</span><span class="o">);</span>
        <span class="n">DefaultShellCallback</span> <span class="n">callback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultShellCallback</span><span class="o">(</span><span class="n">overwrite</span><span class="o">);</span>
        <span class="n">MyBatisGenerator</span> <span class="n">myBatisGenerator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyBatisGenerator</span><span class="o">(</span><span class="n">config</span><span class="o">,</span>
                <span class="n">callback</span><span class="o">,</span> <span class="n">warnings</span><span class="o">);</span>
        <span class="n">myBatisGenerator</span><span class="o">.</span><span class="na">generate</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>

    <span class="o">}</span> 

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">GeneratorDisplay</span> <span class="n">generatorSqlmap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GeneratorDisplay</span><span class="o">();</span>
            <span class="n">generatorSqlmap</span><span class="o">.</span><span class="na">generator</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>通用Mapper</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.utils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">tk.mybatis.mapper.common.Mapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">tk.mybatis.mapper.common.MySqlMapper</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * 继承自己的MyMapper</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MyMapper</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">Mapper</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;,</span> <span class="n">MySqlMapper</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="c1">//TODO</span>
    <span class="c1">//FIXME 特别注意，该接口不能被扫描到，否则会出错</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.mapper</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.demo.pojo.SysUser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.example.demo.utils.MyMapper</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserMapper</span> <span class="kd">extends</span> <span class="n">MyMapper</span><span class="o">&lt;</span><span class="n">SysUser</span><span class="o">&gt;</span> <span class="o">{</span>
<span class="o">}</span>
</pre></div>


<p>自定义Mapper</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.mapper</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.demo.pojo.Person</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Propagation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.transaction.annotation.Transactional</span><span class="o">;</span>

<span class="c1">// 自定义Mapper</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PersonMapper</span> <span class="o">{</span>
    <span class="n">Person</span> <span class="nf">queryUserById</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">);</span>

    <span class="nd">@Transactional</span><span class="o">(</span><span class="n">propagation</span><span class="o">=</span> <span class="n">Propagation</span><span class="o">.</span><span class="na">REQUIRED</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">deleteById</span><span class="o">(</span><span class="n">Integer</span> <span class="n">id</span><span class="o">);</span>

    <span class="nd">@Transactional</span><span class="o">(</span><span class="n">propagation</span><span class="o">=</span> <span class="n">Propagation</span><span class="o">.</span><span class="na">REQUIRED</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">updateById</span><span class="o">(</span><span class="n">Person</span> <span class="n">person</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.pojo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Data</span><span class="o">;</span>

<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">age</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot; &gt;</span>
<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;com.example.demo.mapper.PersonMapper&quot;</span> <span class="nt">&gt;</span>

    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;queryUserById&quot;</span> <span class="na">resultType=</span><span class="s">&quot;com.example.demo.pojo.Person&quot;</span> <span class="na">parameterType=</span><span class="s">&quot;java.lang.Integer&quot;</span><span class="nt">&gt;</span>
    select
        id, name, age
    from
        person
    where
        id = #{id, jdbcType=INTEGER}
    limit 1

 <span class="nt">&lt;/select&gt;</span>

    <span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">&quot;updateById&quot;</span><span class="nt">&gt;</span>
        update person
        set name = #{name}, age = #{age}
        where id = #{id}
    <span class="nt">&lt;/update&gt;</span>

    <span class="nt">&lt;delete</span> <span class="na">id=</span><span class="s">&quot;deleteById&quot;</span><span class="nt">&gt;</span>
        delete from person
        where id = #{id}
    <span class="nt">&lt;/delete&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>
</pre></div>


<p>mybatis<br />
generatorConfig生成mapper和pojo<br />
实现CURD<br />
mybatis-pagehelper实现分页<br />
自定义mapper实现<br />
xml形式的sql形式有利于后期调优<br />
使用包含pagehelper分页的MyBatis的开源框架:<br />
https://github.com/abel533/MyBatis-Spring-Boot</p>
<p>事务：<br />
事务隔离级别<br />
default<br />
read_uncommitted<br />
read_committed<br />
repeatable_read<br />
serializable</p>
<p>事务传播行为<br />
required 有事务直接用，没有新建事务<br />
supports 有事务直接用，没有也可以<br />
mandatory<br />
requires_new<br />
not_supported<br />
never<br />
nested</p>
<p>使用场景</p>
<div class="codehilite"><pre><span></span><span class="nv">@Transactional</span><span class="p">(</span><span class="n">propagation</span><span class="o">=</span><span class="n">Propagation</span><span class="p">.</span><span class="n">SUPPORTS</span><span class="p">)</span><span class="n">查询</span><span class="w"></span>

<span class="nv">@Transactional</span><span class="p">(</span><span class="n">propagation</span><span class="o">=</span><span class="n">Propagation</span><span class="p">.</span><span class="n">REQUIRED</span><span class="p">)</span><span class="n">增加</span><span class="err">，</span><span class="n">删除</span><span class="err">，</span><span class="n">修改</span><span class="w"></span>
</pre></div>


<p>解决devtools与Mapper冲突</p>
<p>添加配置文件 META-INF/spring-devtools.properties</p>
<div class="codehilite"><pre><span></span>restart.include.hifi<span class="o">=</span>/hifi-<span class="o">[</span><span class="se">\\</span>w-<span class="se">\\</span>.<span class="se">\\</span>d<span class="o">]</span>+.jar
restart.include.mybatis<span class="o">=</span>/mybatis-<span class="o">[</span><span class="se">\\</span>w-<span class="se">\\</span>.<span class="se">\\</span>d<span class="o">]</span>+.jar
restart.include.mapper<span class="o">=</span>/mapper-<span class="o">[</span><span class="se">\\</span>w-<span class="se">\\</span>.<span class="se">\\</span>d<span class="o">]</span>+jar
restart.include.pagehelper<span class="o">=</span>/pagehelper-<span class="o">[</span><span class="se">\\</span>w-<span class="se">\\</span>.<span class="se">\\</span>d<span class="o">]</span>+jar
</pre></div>


<h2 id="redis">八、redis</h2>
<p>引入依赖</p>
<div class="codehilite"><pre><span></span><span class="c">&lt;!-- redis--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>


<p>配置</p>
<div class="codehilite"><pre><span></span><span class="c1">############################################################</span>
<span class="c1">#</span>
<span class="c1"># REDIS</span>
<span class="c1">#</span>
<span class="c1">############################################################</span>

spring.redis.database<span class="o">=</span><span class="m">1</span>
spring.redis.host<span class="o">=</span><span class="m">127</span>.0.0.1
spring.redis.port<span class="o">=</span><span class="m">6379</span>
spring.redis.password<span class="o">=</span>
spring.redis.pool.max-active<span class="o">=</span><span class="m">1000</span>
spring.redis.pool.max-wait<span class="o">=</span>-1
spring.redis.pool.max-idle<span class="o">=</span><span class="m">10</span>
spring.redis.pool.min-idle<span class="o">=</span><span class="m">2</span>
spring.redis.timeout<span class="o">=</span><span class="m">0</span>
</pre></div>


<p>使用</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.demo.pojo.JsonResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.redis.core.StringRedisTemplate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>


<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedisController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">StringRedisTemplate</span> <span class="n">redisTemplate</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&quot;/redis&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">JsonResult</span> <span class="nf">error</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">set</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Tom&quot;</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">JsonResult</span><span class="o">.</span><span class="na">success</span><span class="o">(</span><span class="n">redisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">));</span>
    <span class="o">}</span>


<span class="o">}</span>
</pre></div>


<h2 id="_5">九、定时任务</h2>
<div class="codehilite"><pre><span></span><span class="nd">@EnableScheduling</span> <span class="c1">// 开启定时任务</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.task</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.scheduling.annotation.Scheduled</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloTask</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">SimpleDateFormat</span> <span class="n">dateFormat</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="o">(</span><span class="s">&quot;HH:mm:ss&quot;</span><span class="o">);</span>
    <span class="c1">// 每3秒执行一次</span>
    <span class="nd">@Scheduled</span><span class="o">(</span><span class="n">fixedRate</span> <span class="o">=</span> <span class="mi">3000</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">echo</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;echo: &quot;</span> <span class="o">+</span> <span class="n">dateFormat</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="k">new</span> <span class="n">Date</span><span class="o">()));</span>
    <span class="o">}</span>


<span class="o">}</span>
</pre></div>


<h2 id="_6">十、异步任务</h2>
<div class="codehilite"><pre><span></span><span class="nd">@EnableAsync</span> <span class="c1">// 开启异步任务</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.task</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.scheduling.annotation.Async</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloTask</span> <span class="o">{</span>

    <span class="nd">@Async</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sayHello</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">5000</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h2 id="_7">十一、拦截器</h2>
<p>定义拦截器</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.interceptor</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.HandlerInterceptor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ModelAndView</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloInterceptor</span> <span class="kd">implements</span> <span class="n">HandlerInterceptor</span> <span class="o">{</span>

    <span class="c1">// 请求处理之前</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;preHandle&quot;</span><span class="o">);</span>

        <span class="k">if</span><span class="o">(</span><span class="s">&quot;Tom&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&quot;key&quot;</span><span class="o">))){</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;被拦截&quot;</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span><span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;放行&quot;</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">// 请求处理之后</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;postHandle&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;afterCompletion&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>注册拦截器</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.example.demo.config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.example.demo.interceptor.HelloInterceptor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.InterceptorRegistry</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurer</span><span class="o">;</span>

<span class="c1">//WebMvcConfigurerAdapter已经被废弃了</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyWebMvcConfigurer</span> <span class="kd">implements</span> <span class="n">WebMvcConfigurer</span> <span class="o">{</span>
    <span class="c1">// 拦截器按照顺序执行</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addInterceptors</span><span class="o">(</span><span class="n">InterceptorRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="k">new</span> <span class="n">HelloInterceptor</span><span class="o">()).</span><span class="na">addPathPatterns</span><span class="o">(</span><span class="s">&quot;/**&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            2019-2021
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/mouday" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../assets/javascripts/lunr/lunr.ja.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>