



<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="ja">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>笔记 Spring配置xml和注解 - 学习笔记</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#java-web" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="学习笔记" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              学习笔记
            </span>
            <span class="md-header-nav__topic">
              
                笔记 Spring配置xml和注解
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="学习笔记" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    学习笔记
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="主页" class="md-nav__link">
      主页
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Python/" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../php/" title="PHP" class="md-nav__link">
      PHP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../ElasticSearch/" title="ElasticSearch" class="md-nav__link">
      ElasticSearch
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../JavaScript/" title="JavaScript" class="md-nav__link">
      JavaScript
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../MySQL/" title="MySQL" class="md-nav__link">
      MySQL
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../人工智能/" title="人工智能" class="md-nav__link">
      人工智能
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../LEK/" title="LEK" class="md-nav__link">
      LEK
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../设计模式/" title="设计模式" class="md-nav__link">
      设计模式
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../Linux/" title="Linux" class="md-nav__link">
      Linux
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../前端/" title="前端" class="md-nav__link">
      前端
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#java-web" class="md-nav__link">
    Java Web发展历史
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ioc" class="md-nav__link">
    课程内容IoC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ioc_1" class="md-nav__link">
    IoC介绍
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ioc_2" class="md-nav__link">
    IoC实现
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#spring-ioc" class="md-nav__link">
    Spring IoC
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bean" class="md-nav__link">
    实例化Bean方式
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bean_1" class="md-nav__link">
    注入Bean方式
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bean_2" class="md-nav__link">
    Bean作用域
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    方法注入
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web" class="md-nav__link">
    Web环境作用域
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    自定义作用域
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simplethreadscope" class="md-nav__link">
    simpleThreadScope
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bean_3" class="md-nav__link">
    Bean的懒加载
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bean_4" class="md-nav__link">
    Bean的初始化及销毁逻辑处理
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bean_5" class="md-nav__link">
    Bean属性继承
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#springioc" class="md-nav__link">
    SpringIoC注解的基本使用
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    包扫描
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bean_6" class="md-nav__link">
    Bean别名
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bean_7" class="md-nav__link">
    通过注解注入Bean
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bean_8" class="md-nav__link">
    通过注解设定Bean的作用域
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bean_9" class="md-nav__link">
    Bean注解的方式进行方法注入
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bean_10" class="md-nav__link">
    通过注解开启Bean的懒加载
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bean_11" class="md-nav__link">
    通过注解编写Bean初始化及销毁
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>笔记 Spring配置xml和注解</h1>
                
                <p>Spring</p>
<h2 id="java-web">Java Web发展历史</h2>
<ul>
<li>第一阶段 JavaBean + Servlet + JSP</li>
<li>第二阶段 EJB重量级框架</li>
<li>第三阶段 SpringMVC/Struts + Spring + Hibernate/MyBatis</li>
<li>第四阶段 SpringBoot 约定大于配置</li>
<li>第五阶段 Dubbo为代表的SOA微服务架构体系</li>
<li>第六阶段 SpringCloud 微服务框架爱技术生态圈</li>
</ul>
<h2 id="ioc">课程内容IoC</h2>
<ul>
<li>介绍IoC并编写一个简单的IoC容器</li>
<li>介绍通过xml方式完成SpringIoC对Bean的管理</li>
<li>介绍SpringIoC相关注解的使用</li>
</ul>
<h2 id="ioc_1">IoC介绍</h2>
<p>IoC Inversion of Control 控制反转，依赖注入</p>
<p>控制：控制对象的创建及销毁（生命周期）<br />
反转：将对象的控制权交给IoC容器</p>
<p>简化约定<br />
- 所有的Bean的生命周期都交由IoC容器管理<br />
- 所有被依赖的Bean通过构造函数方法执行注入<br />
- 被依赖的Bean需要优先创建</p>
<h2 id="ioc_2">IoC实现</h2>
<p>依赖关系</p>
<div class="codehilite"><pre><span></span>Car
    +start<span class="o">()</span>
    +stop<span class="o">()</span>
    +turnLeft<span class="o">()</span>
    +turnRight<span class="o">()</span>

    &lt;- AudiCar
    &lt;- BuickCar


Human
    +goHome<span class="o">()</span>

    &lt;- HumanWithCar
        -car
        +goHome<span class="o">()</span>

        &lt;- LisiHuman
        &lt;- ZhangsanHuman
</pre></div>


<p>代码实现</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc.car</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * 汽车</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Car</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">start</span><span class="o">();</span>
    <span class="kt">void</span> <span class="nf">stop</span><span class="o">();</span>
    <span class="kt">void</span> <span class="nf">turnLeft</span><span class="o">();</span>
    <span class="kt">void</span> <span class="nf">turnRight</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc.car</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * 奥迪车</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AudiCar</span> <span class="kd">implements</span> <span class="n">Car</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;AudiCar start&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;AudiCar stop&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">turnLeft</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;AudiCar turnLeft&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">turnRight</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;AudiCar turnRight&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc.car</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * 别克车</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BuickCar</span> <span class="kd">implements</span> <span class="n">Car</span><span class="o">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;BuickCar start&quot;</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;BuickCar stop&quot;</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">turnLeft</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;BuickCar turnLeft&quot;</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">turnRight</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;BuickCar turnRight&quot;</span><span class="o">);</span>

    <span class="o">}</span>

<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc.human</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * 人类接口</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Human</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">goHome</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc.human</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.demo.ioc.car.Car</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * 有车人</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">HumanWithCar</span> <span class="kd">implements</span> <span class="n">Human</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="n">Car</span> <span class="n">car</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">HumanWithCar</span><span class="o">(</span><span class="n">Car</span> <span class="n">car</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">car</span> <span class="o">=</span> <span class="n">car</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">goHome</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc.human</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.demo.ioc.car.Car</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * 张三</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ZhangsanHuman</span> <span class="kd">extends</span> <span class="n">HumanWithCar</span><span class="o">{</span>
    <span class="kd">public</span> <span class="nf">ZhangsanHuman</span><span class="o">(</span><span class="n">Car</span> <span class="n">car</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">car</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">goHome</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">car</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">car</span><span class="o">.</span><span class="na">turnLeft</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">car</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc.human</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.demo.ioc.car.Car</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * 李四</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LisiHuman</span> <span class="kd">extends</span> <span class="n">HumanWithCar</span><span class="o">{</span>
    <span class="kd">public</span> <span class="nf">LisiHuman</span><span class="o">(</span><span class="n">Car</span> <span class="n">car</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">car</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">goHome</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">car</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">car</span><span class="o">.</span><span class="na">turnRight</span><span class="o">();</span>
        <span class="k">this</span><span class="o">.</span><span class="na">car</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">java.lang.reflect.Constructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationTargetException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ConcurrentHashMap</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * 1. 实例化Bean</span>
<span class="cm"> * 2. 保存Bean</span>
<span class="cm"> * 3. 提供Bean</span>
<span class="cm"> * 4. 每个Bean要与唯一的id对应</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IocContainer</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">beans</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>

    <span class="cm">/**</span>
<span class="cm">     * 根据 beanId获取Bean</span>
<span class="cm">     *</span>
<span class="cm">     * @param beanId</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getBean</span><span class="o">(</span><span class="n">String</span> <span class="n">beanId</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">beans</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">beanId</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 委托IoC容器创建一个Bean</span>
<span class="cm">     *</span>
<span class="cm">     * @param clazz        Bean的class</span>
<span class="cm">     * @param beanId       Bean 的id</span>
<span class="cm">     * @param paramBeanIds class构造函数所需参数的beanId</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBean</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">,</span> <span class="n">String</span> <span class="n">beanId</span><span class="o">,</span> <span class="n">String</span><span class="o">...</span> <span class="n">paramBeanIds</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//  1. 组装构造方法所需要的参数值</span>
        <span class="n">Object</span><span class="o">[]</span> <span class="n">paramBeans</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[</span><span class="n">paramBeanIds</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">paramBeanIds</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">paramBeans</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">beans</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">paramBeanIds</span><span class="o">[</span><span class="n">i</span><span class="o">]);</span>
        <span class="o">}</span>

        <span class="c1">//  2. 调用构造方法实例化Bean</span>
        <span class="n">Object</span> <span class="n">bean</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Constructor</span><span class="o">&lt;?&gt;</span> <span class="n">constructor</span><span class="o">:</span> <span class="n">clazz</span><span class="o">.</span><span class="na">getConstructors</span><span class="o">()){</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">bean</span> <span class="o">=</span> <span class="n">constructor</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">paramBeans</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InstantiationException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IllegalAccessException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InvocationTargetException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">if</span><span class="o">(</span><span class="n">bean</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="s">&quot;Bean实例化失败&quot;</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">//  3. 将示例化的bean放入beans</span>
        <span class="n">beans</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">beanId</span><span class="o">,</span> <span class="n">bean</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>代码回顾<br />
所有的依赖关系被集中统一的管理起来，清晰明了<br />
每个类只需要关注自己的业务逻辑<br />
修改依赖关系将是一件很容易的事情</p>
<h2 id="spring-ioc">Spring IoC</h2>
<p>依赖pom.xml</p>
<div class="codehilite"><pre><span></span> <span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-core<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>4.3.7.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>4.3.7.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>4.13<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Bean</span> <span class="o">{</span>

<span class="o">}</span>
</pre></div>


<p>spring.xml</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>

<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">                        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!--将bean交由Spring创建并管理--&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>


<p>测试</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.ClassPathXmlApplicationContext</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BeanTest</span> <span class="o">{</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testBean</span><span class="o">(){</span>
        <span class="c1">// 获取上下文</span>
        <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">&quot;spring.xml&quot;</span><span class="o">);</span>

        <span class="c1">// 获取bean</span>
        <span class="n">Bean</span> <span class="n">bean</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&quot;bean&quot;</span><span class="o">,</span> <span class="n">Bean</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h2 id="bean">实例化Bean方式</h2>
<ul>
<li>通过构造方法实例化Bean</li>
<li>通过静态方法实例化Bean</li>
<li>通过实例方法实例化Bean</li>
<li>Bean的别名</li>
</ul>
<p>1、通过构造方法实例化Bean</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Bean</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">Bean</span><span class="o">(){}</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span><span class="nt">/&gt;</span>
</pre></div>


<p>2、通过静态方法实例化Bean</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BeanFactory</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Bean</span> <span class="nf">createBean</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Bean</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.BeanFactory&quot;</span> <span class="na">factory-method=</span><span class="s">&quot;createBean&quot;</span><span class="nt">/&gt;</span>
</pre></div>


<p>3、通过实例方法实例化Bean</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BeanFactory</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">Bean</span> <span class="nf">createBean</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Bean</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;beanFactory&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.BeanFactory&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span> <span class="na">factory-bean=</span><span class="s">&quot;beanFactory&quot;</span> <span class="na">factory-method=</span><span class="s">&quot;createBean&quot;</span><span class="nt">/&gt;</span>
</pre></div>


<p>4、Bean的别名</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span> <span class="na">name=</span><span class="s">&quot;bean1,bean2&quot;</span><span class="nt">/&gt;</span>
<span class="c">&lt;!-- alias不支持逗号分隔 --&gt;</span>
<span class="nt">&lt;alias</span> <span class="na">name=</span><span class="s">&quot;bean&quot;</span> <span class="na">alias=</span><span class="s">&quot;bean3&quot;</span><span class="nt">/&gt;</span>
</pre></div>


<h2 id="bean_1">注入Bean方式</h2>
<p>通过构造方法注入Bean<br />
通过set方式注入Bean<br />
集合类Bean的注入（List、Set、Map、Properties）<br />
null注入<br />
注入时创建内部Bean</p>
<p>1、通过构造方法注入Bean</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Bean</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">AnotherBean</span> <span class="n">anotherBean</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Bean</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">AnotherBean</span> <span class="n">anotherBean</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">anotherBean</span> <span class="o">=</span> <span class="n">anotherBean</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">AnotherBean</span> <span class="nf">getAnotherBean</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">anotherBean</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAnotherBean</span><span class="o">(</span><span class="n">AnotherBean</span> <span class="n">anotherBean</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">anotherBean</span> <span class="o">=</span> <span class="n">anotherBean</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;Bean{&quot;</span> <span class="o">+</span>
                <span class="s">&quot;name=&#39;&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="sc">&#39;\&#39;&#39;</span> <span class="o">+</span>
                <span class="s">&quot;, anotherBean=&quot;</span> <span class="o">+</span> <span class="n">anotherBean</span> <span class="o">+</span>
                <span class="sc">&#39;}&#39;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AnotherBean</span> <span class="o">{</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;anotherBean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.AnotherBean&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- index、name、type三个属性组合确定参数 --&gt;</span>
    <span class="c">&lt;!-- value用于简单数据类型 --&gt;</span>
    <span class="c">&lt;!-- ref用于复杂数据类型 --&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;0&quot;</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">type=</span><span class="s">&quot;java.lang.String&quot;</span> <span class="na">value=</span><span class="s">&quot;Tom&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">&quot;1&quot;</span> <span class="na">name=</span><span class="s">&quot;anotherBean&quot;</span> <span class="na">type=</span><span class="s">&quot;com.demo.ioc.AnotherBean&quot;</span> <span class="na">ref=</span><span class="s">&quot;anotherBean&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/bean&gt;</span>
</pre></div>


<p>简化写法</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>

<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="na">xmlns:c=</span><span class="s">&quot;http://www.springframework.org/schema/c&quot;</span>
       <span class="na">xmlns:p=</span><span class="s">&quot;http://www.springframework.org/schema/p&quot;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">                        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;anotherBean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.AnotherBean&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span>
          <span class="na">c:name=</span><span class="s">&quot;Jack&quot;</span> <span class="na">c:anotherBean-ref=</span><span class="s">&quot;anotherBean&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>


<p>2、通过set方式注入Bean</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Bean</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">AnotherBean</span> <span class="n">anotherBean</span><span class="o">;</span>


    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">AnotherBean</span> <span class="nf">getAnotherBean</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">anotherBean</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAnotherBean</span><span class="o">(</span><span class="n">AnotherBean</span> <span class="n">anotherBean</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">anotherBean</span> <span class="o">=</span> <span class="n">anotherBean</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;Bean{&quot;</span> <span class="o">+</span>
                <span class="s">&quot;name=&#39;&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="sc">&#39;\&#39;&#39;</span> <span class="o">+</span>
                <span class="s">&quot;, anotherBean=&quot;</span> <span class="o">+</span> <span class="n">anotherBean</span> <span class="o">+</span>
                <span class="sc">&#39;}&#39;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;anotherBean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.AnotherBean&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">value=</span><span class="s">&quot;Jack&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;anotherBean&quot;</span> <span class="na">ref=</span><span class="s">&quot;anotherBean&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>


<p>简化写法</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>

<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="na">xmlns:c=</span><span class="s">&quot;http://www.springframework.org/schema/c&quot;</span>
       <span class="na">xmlns:p=</span><span class="s">&quot;http://www.springframework.org/schema/p&quot;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">                        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="nt">&gt;</span>


    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;anotherBean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.AnotherBean&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span>
          <span class="na">p:name=</span><span class="s">&quot;Jack&quot;</span> <span class="na">p:anotherBean-ref=</span><span class="s">&quot;anotherBean&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>


<p>3、集合类Bean的注入（List、Set、Map、Properties）</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Properties</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Bean</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">stringList</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">AnotherBean</span><span class="o">&gt;</span> <span class="n">anotherBeanList</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">stringSet</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">AnotherBean</span><span class="o">&gt;</span> <span class="n">anotherBeanSet</span><span class="o">;</span>


    <span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">stringMap</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">AnotherBean</span><span class="o">&gt;</span> <span class="n">anotherBeanMap</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">Properties</span> <span class="n">properties</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">AnotherBean</span> <span class="n">anotherBean1</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">AnotherBean</span> <span class="n">anotherBean2</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAnotherBean1</span><span class="o">(</span><span class="n">AnotherBean</span> <span class="n">anotherBean1</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">anotherBean1</span> <span class="o">=</span> <span class="n">anotherBean1</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAnotherBean2</span><span class="o">(</span><span class="n">AnotherBean</span> <span class="n">anotherBean2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">anotherBean2</span> <span class="o">=</span> <span class="n">anotherBean2</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProperties</span><span class="o">(</span><span class="n">Properties</span> <span class="n">properties</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">properties</span> <span class="o">=</span> <span class="n">properties</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStringList</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">stringList</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">stringList</span> <span class="o">=</span> <span class="n">stringList</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAnotherBeanList</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">AnotherBean</span><span class="o">&gt;</span> <span class="n">anotherBeanList</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">anotherBeanList</span> <span class="o">=</span> <span class="n">anotherBeanList</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStringSet</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">stringSet</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">stringSet</span> <span class="o">=</span> <span class="n">stringSet</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAnotherBeanSet</span><span class="o">(</span><span class="n">Set</span><span class="o">&lt;</span><span class="n">AnotherBean</span><span class="o">&gt;</span> <span class="n">anotherBeanSet</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">anotherBeanSet</span> <span class="o">=</span> <span class="n">anotherBeanSet</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStringMap</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">stringMap</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">stringMap</span> <span class="o">=</span> <span class="n">stringMap</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAnotherBeanMap</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">AnotherBean</span><span class="o">&gt;</span> <span class="n">anotherBeanMap</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">anotherBeanMap</span> <span class="o">=</span> <span class="n">anotherBeanMap</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;anotherBean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.AnotherBean&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;stringList&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;list&gt;</span>
            <span class="nt">&lt;value&gt;</span>Tom<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>Jack<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/list&gt;</span>
    <span class="nt">&lt;/property&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;anotherBeanList&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;list&gt;</span>
            <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;anotherBean&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;anotherBean&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/list&gt;</span>
    <span class="nt">&lt;/property&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;stringSet&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;set&gt;</span>
            <span class="nt">&lt;value&gt;</span>Tom<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>Jack<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/set&gt;</span>
    <span class="nt">&lt;/property&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;anotherBeanSet&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;set&gt;</span>
            <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;anotherBean&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">&quot;anotherBean&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/set&gt;</span>
    <span class="nt">&lt;/property&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;stringMap&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;map&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;name&quot;</span> <span class="na">value=</span><span class="s">&quot;Tom&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;age&quot;</span> <span class="na">value=</span><span class="s">&quot;23&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
    <span class="nt">&lt;/property&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;anotherBeanMap&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;map&gt;</span>
           <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;name&quot;</span> <span class="na">value-ref=</span><span class="s">&quot;anotherBean&quot;</span><span class="nt">/&gt;</span>
           <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;age&quot;</span> <span class="na">value-ref=</span><span class="s">&quot;anotherBean&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
    <span class="nt">&lt;/property&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;properties&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;props&gt;</span>
            <span class="nt">&lt;prop</span> <span class="na">key=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Tom<span class="nt">&lt;/prop&gt;</span>
        <span class="nt">&lt;/props&gt;</span>
    <span class="nt">&lt;/property&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;anotherBean1&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- null注入 --&gt;</span>
        <span class="nt">&lt;null/&gt;</span>
    <span class="nt">&lt;/property&gt;</span>

    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;anotherBean2&quot;</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- 注入时创建内部Bean --&gt;</span>
        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.AnotherBean&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>


<h2 id="bean_2">Bean作用域</h2>
<ul>
<li>singleton作用域（单例，限定在一个上下文环境中）</li>
<li>prototype作用域（多例）</li>
<li>Web环境作用域<ul>
<li>request作用域</li>
<li>session作用域</li>
<li>application作用域</li>
<li>websocket作用域</li>
</ul>
</li>
<li>自定义作用域<ul>
<li>SimpleThreadScope作用域</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c">&lt;!-- 单例 默认singleton --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span><span class="nt">/&gt;</span>

<span class="c">&lt;!-- 多例 --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span> <span class="na">scope=</span><span class="s">&quot;prototype&quot;</span><span class="nt">/&gt;</span>
</pre></div>


<p>总结</p>
<p>配置</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean2&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean2&quot;</span> <span class="na">scope=</span><span class="s">&quot;prototype&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean1&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean1&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;bean2&quot;</span> <span class="na">ref=</span><span class="s">&quot;bean2&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>


<table>
<thead>
<tr>
<th>-</th>
<th>Bean1-singleton</th>
<th>Bean1-prototype</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bean2-singleton</td>
<td>bean1单实例、bean2单实例</td>
<td>bean1多实例、bean2单实例</td>
</tr>
<tr>
<td>Bean2-prototype</td>
<td>bean1单实例、bean2单实例</td>
<td>bean1多实例、bean2多实例</td>
</tr>
</tbody>
</table>
<h2 id="_1">方法注入</h2>
<p>场景：<br />
Bean1是singleton, Bean2是prototype, Bean1依赖于Bean2<br />
我们希望每次调用Bean1某个方法时候，该方法每次拿到Bean2都是新的实例</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Bean2</span> <span class="o">{</span>

<span class="o">}</span>

<span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Bean1</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kd">abstract</span> <span class="n">Bean2</span> <span class="nf">createBean2</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean2&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean2&quot;</span> <span class="na">scope=</span><span class="s">&quot;prototype&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean1&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean1&quot;</span> <span class="na">scope=</span><span class="s">&quot;singleton&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;lookup-method</span> <span class="na">name=</span><span class="s">&quot;createBean2&quot;</span> <span class="na">bean=</span><span class="s">&quot;bean2&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>


<h2 id="web">Web环境作用域</h2>
<p>项目结构</p>
<div class="codehilite"><pre><span></span>$ tree
.
├── pom.xml
└── src
   └── main
      ├── java
      │   └── com
      │       └── demo
      │           ├── ApplicationController.java
      │           ├── RequestController.java
      │           └── SessionController.java
      ├── resources
      │   └── spring.xml
      └── webapp
          └── WEB-INF
              └── web.xml
</pre></div>


<p>pom.xml</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
         <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 </span>
<span class="s">         http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;groupId&gt;</span>spring-mvc<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>com.demo<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="c">&lt;!--打包方式为war--&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-core<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.1.3.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.1.3.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-web<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.1.3.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-webmvc<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.1.3.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre></div>


<p>web.xml</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>

<span class="nt">&lt;web-app</span> <span class="na">version=</span><span class="s">&quot;3.0&quot;</span>
         <span class="na">xmlns=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
         <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://java.sun.com/xml/ns/javaee</span>
<span class="s">         http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
<span class="nt">&gt;</span>
    <span class="c">&lt;!-- 建立SpringWeb上下文环境--&gt;</span>
    <span class="nt">&lt;servlet&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>SpringServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
        <span class="nt">&lt;init-param&gt;</span>
            <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
            <span class="nt">&lt;param-value&gt;</span>classpath:spring.xml<span class="nt">&lt;/param-value&gt;</span>
        <span class="nt">&lt;/init-param&gt;</span>
    <span class="nt">&lt;/servlet&gt;</span>

    <span class="nt">&lt;servlet-mapping&gt;</span>
        <span class="nt">&lt;servlet-name&gt;</span>SpringServlet<span class="nt">&lt;/servlet-name&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/servlet-mapping&gt;</span>
<span class="nt">&lt;/web-app&gt;</span>
</pre></div>


<p>RequestController.java</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RequestController</span> <span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;/request&quot;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">test</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>SessionController.java</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SessionController</span> <span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;/session&quot;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">test</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>ApplicationController.java</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.ResponseBody</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplicationController</span> <span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;/application&quot;</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">test</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>总结</p>
<p>reuqest：每个request请求都会创建一个单独的实例。</p>
<p>session：每个session都会创建一个单独的实例。</p>
<p>application：每个sercletContext都会创建一个单独的实例。</p>
<p>websocket：每个websocket链接都会创建一个单独的实例。</p>
<h2 id="_2">自定义作用域</h2>
<p>双例模式</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.ObjectFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.config.Scope</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ConcurrentHashMap</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * 自定义作用域</span>
<span class="cm"> * 实现双例模式（每一个Bean对应两个实例）</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyScope</span> <span class="kd">implements</span> <span class="n">Scope</span> <span class="o">{</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">ObjectFactory</span><span class="o">&lt;?&gt;</span> <span class="n">objectFactory</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//先从map1取</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">map1</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">objectFactory</span><span class="o">.</span><span class="na">getObject</span><span class="o">();</span>
            <span class="n">map1</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">obj</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="c1">//再从map2取</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">map2</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">objectFactory</span><span class="o">.</span><span class="na">getObject</span><span class="o">();</span>
            <span class="n">map2</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">obj</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="c1">// 如果map1和map2中都存在则随机返回</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">map1</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">map2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">remove</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 和添加顺序正好相反</span>

        <span class="k">if</span><span class="o">(</span><span class="n">map2</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">name</span><span class="o">)){</span>
            <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">map2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
            <span class="n">map2</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span><span class="o">(</span><span class="n">map1</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">name</span><span class="o">)){</span>
            <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">map1</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
            <span class="n">map1</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">registerDestructionCallback</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Runnable</span> <span class="n">callback</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">resolveContextualObject</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getConversationId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Bean</span> <span class="o">{</span>

<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>

<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="na">xmlns:jee=</span><span class="s">&quot;http://www.springframework.org/schema/jee&quot;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">                        http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class="s">                        http://www.springframework.org/schema/jee</span>
<span class="s">                        http://www.springframework.org/schema/jee/spring-jee.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;myScope&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.MyScope&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.beans.factory.config.CustomScopeConfigurer&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;scopes&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;map&gt;</span>
                <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;myScope&quot;</span> <span class="na">value-ref=</span><span class="s">&quot;myScope&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/map&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">scope=</span><span class="s">&quot;myScope&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>


<p>测试</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.ClassPathXmlApplicationContext</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BeanTest</span> <span class="o">{</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testBean</span><span class="o">(){</span>
        <span class="c1">// 获取上下文</span>
        <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">&quot;spring.xml&quot;</span><span class="o">);</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">Bean</span> <span class="n">bean</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&quot;bean&quot;</span><span class="o">,</span> <span class="n">Bean</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h2 id="simplethreadscope">simpleThreadScope</h2>
<p>每个线程都会创建一个单独的实例</p>
<div class="codehilite"><pre><span></span><span class="c">&lt;!--单线程中只有一个实例--&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;simpleThreadScope&quot;</span> <span class="na">class=</span><span class="s">&quot;org.springframework.context.support.SimpleThreadScope&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.beans.factory.config.CustomScopeConfigurer&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;scopes&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;map&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;simpleThreadScope&quot;</span> <span class="na">value-ref=</span><span class="s">&quot;simpleThreadScope&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">scope=</span><span class="s">&quot;simpleThreadScope&quot;</span><span class="nt">/&gt;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.ClassPathXmlApplicationContext</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BeanTest</span> <span class="o">{</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testBean</span><span class="o">(){</span>
        <span class="c1">// 获取上下文</span>
        <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">&quot;spring.xml&quot;</span><span class="o">);</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">Bean</span> <span class="n">bean</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&quot;bean&quot;</span><span class="o">,</span> <span class="n">Bean</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                    <span class="n">Bean</span> <span class="n">bean</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&quot;bean&quot;</span><span class="o">,</span> <span class="n">Bean</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}).</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h2 id="bean_3">Bean的懒加载</h2>
<p>Spring容器会在创建容器时，提前初始化Singleton（单例）作用域的bean，<br />
但是如果Bean被标注了lazy-init="true"，<br />
则该Bean只有在其在被需要的时候才会被初始化。</p>
<p>注意：只对Singleton（单例）作用域的bean有效，其他作用域如多例并不知道什么这个bean才会被需要实例化。</p>
<p>为某个Bean设定为懒加载</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">lazy-init=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
</pre></div>


<p>为所有Bean设定为懒加载</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;beans</span> <span class="na">default-lazy-init=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>


<p>适用场景</p>
<p>如果某个Bean在程序整个运行周期都可能不会被使用，那么可考虑设定该Bean为懒加载。</p>
<p>优点：尽可能的节省了资源。</p>
<p>缺点：可能会导致某个操作响应时间增加。</p>
<h2 id="bean_4">Bean的初始化及销毁逻辑处理</h2>
<p>1、如果需要在Bean实例化之后执行一些逻辑，有两种方法：</p>
<ul>
<li>
<p>使用init-method属性</p>
</li>
<li>
<p>让Bean实现InitializingBean接口</p>
</li>
</ul>
<p>2、如果需要在Bean销毁之前执行一些逻辑，有两种方法： </p>
<ul>
<li>
<p>使用destory-method属性</p>
</li>
<li>
<p>让Bean实现DisposableBean接口</p>
</li>
</ul>
<p>3、通过指定方法名实现</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Bean</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onInit</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;onInit&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;onDestroy&quot;</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>


<p>单个Bean初始化和销毁方法执行</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">init-method=</span><span class="s">&quot;onInit&quot;</span> <span class="na">destroy-method=</span><span class="s">&quot;onDestroy&quot;</span><span class="nt">/&gt;</span>
</pre></div>


<p>所有Bean初始化和销毁方法执行</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;beans</span> 
       <span class="na">default-init-method=</span><span class="s">&quot;onInit&quot;</span>
       <span class="na">default-destroy-method=</span><span class="s">&quot;onDestroy&quot;</span>
<span class="nt">&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.AbstractApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.ClassPathXmlApplicationContext</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BeanTest</span> <span class="o">{</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testBean</span><span class="o">(){</span>
        <span class="c1">// 获取上下文</span>
        <span class="n">AbstractApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">&quot;spring.xml&quot;</span><span class="o">);</span>
        <span class="c1">// 关闭上下文</span>
        <span class="n">context</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>4、通过实现接口</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.DisposableBean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.InitializingBean</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Bean</span> <span class="kd">implements</span> <span class="n">InitializingBean</span><span class="o">,</span> <span class="n">DisposableBean</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;destroy&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterPropertiesSet</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;afterPropertiesSet&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h2 id="bean_5">Bean属性继承</h2>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child1</span> <span class="kd">extends</span> <span class="n">Parent</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name1</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName1</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name1</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName1</span><span class="o">(</span><span class="n">String</span> <span class="n">name1</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name1</span> <span class="o">=</span> <span class="n">name1</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;Child1{&quot;</span> <span class="o">+</span>
                <span class="s">&quot;name=&#39;&quot;</span> <span class="o">+</span> <span class="n">getName</span><span class="o">()</span> <span class="o">+</span> <span class="sc">&#39;\&#39;&#39;</span> <span class="o">+</span>
                <span class="s">&quot;name1=&#39;&quot;</span> <span class="o">+</span> <span class="n">name1</span> <span class="o">+</span> <span class="sc">&#39;\&#39;&#39;</span> <span class="o">+</span>
                <span class="sc">&#39;}&#39;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>


<span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child2</span> <span class="kd">extends</span> <span class="n">Parent</span><span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name2</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName2</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name2</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName2</span><span class="o">(</span><span class="n">String</span> <span class="n">name2</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name2</span> <span class="o">=</span> <span class="n">name2</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;Child1{&quot;</span> <span class="o">+</span>
                <span class="s">&quot;name=&#39;&quot;</span> <span class="o">+</span> <span class="n">getName</span><span class="o">()</span> <span class="o">+</span> <span class="sc">&#39;\&#39;&#39;</span> <span class="o">+</span>
                <span class="s">&quot;name2=&#39;&quot;</span> <span class="o">+</span> <span class="n">name2</span> <span class="o">+</span> <span class="sc">&#39;\&#39;&#39;</span> <span class="o">+</span>
                <span class="sc">&#39;}&#39;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>继承关系配置</p>
<div class="codehilite"><pre><span></span><span class="c">&lt;!-- 这个javaBean不需要实例化 --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;parent&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Parent&quot;</span> <span class="na">abstract=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">value=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;child1&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Child1&quot;</span> <span class="na">parent=</span><span class="s">&quot;parent&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;name1&quot;</span> <span class="na">value=</span><span class="s">&quot;name1&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;child2&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Child2&quot;</span> <span class="na">parent=</span><span class="s">&quot;parent&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;name2&quot;</span> <span class="na">value=</span><span class="s">&quot;name1&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>


<p>或者非继承关系，有相同的属性</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;parent&quot;</span> <span class="na">abstract=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;name&quot;</span> <span class="na">value=</span><span class="s">&quot;name&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;child1&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Child1&quot;</span> <span class="na">parent=</span><span class="s">&quot;parent&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;name1&quot;</span> <span class="na">value=</span><span class="s">&quot;name1&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;child2&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Child2&quot;</span> <span class="na">parent=</span><span class="s">&quot;parent&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;name2&quot;</span> <span class="na">value=</span><span class="s">&quot;name1&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>


<h2 id="springioc">SpringIoC注解的基本使用</h2>
<p>pom.xml依赖</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-core<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>5.1.3.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>

<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>5.1.3.RELEASE<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>4.13<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>


<p>1、使用xml文件</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Bean</span><span class="o">{</span>
<span class="o">}</span>
</pre></div>


<p>创建spring.xml配置文件</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>

<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">                        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>

<span class="nt">&gt;</span>
    <span class="c">&lt;!-- 将Bean交由Spring创建并管理 --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</pre></div>


<p>获取Bean</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.ClassPathXmlApplicationContext</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BeanTest</span> <span class="o">{</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testBean</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 获取上下文</span>
        <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">&quot;spring.xml&quot;</span><span class="o">);</span>

        <span class="c1">// 获取Bean</span>
        <span class="n">Bean</span> <span class="n">bean</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&quot;bean&quot;</span><span class="o">,</span> <span class="n">Bean</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>2、使用annotation</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc.human</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.demo.ioc.Person</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>

<span class="c1">// 创建配置文件</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfiguration</span> <span class="o">{</span>
    <span class="c1">// 将Bean交由Spring创建并管理</span>
    <span class="c1">// name参数可以省略，默认方法名就是bean的名称</span>
    <span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;person&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Person</span> <span class="nf">person</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>获取Bean</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.demo.ioc.human.MyConfiguration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BeanTest</span> <span class="o">{</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testBean</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 获取上下文</span>
        <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span>
                <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">MyConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="c1">// 获取Bean</span>
        <span class="n">Person</span> <span class="n">bean</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&quot;person&quot;</span><span class="o">,</span> <span class="n">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h2 id="_3">包扫描</h2>
<p>1、xml方式</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>

<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.springframework.org/schema/beans</span>
<span class="s">                        http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>

<span class="nt">&gt;</span>
    <span class="c">&lt;!--开启包扫描--&gt;</span>
    <span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&quot;com.demo.ioc&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre></div>


<p>2、注解方式</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>

<span class="c1">// 创建配置文件,可以认为是一个xml配置文件</span>
<span class="nd">@Configuration</span>
<span class="c1">// 设置需要扫描的包</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;com.demo.ioc&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfiguration</span> <span class="o">{</span>

<span class="o">}</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="c1">// 增加注解后会被Spring扫描到, 默认的Id是类名首字母小写</span>
<span class="nd">@Component</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;person&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
<span class="o">}</span>
</pre></div>


<p>注解</p>
<div class="codehilite"><pre><span></span><span class="nd">@Component</span>     <span class="c1">// 通用型注解</span>
<span class="nd">@Controller</span>    <span class="c1">// Controller层</span>
<span class="nd">@Service</span>       <span class="c1">// Service层</span>
<span class="nd">@Repository</span>    <span class="c1">// Dao层</span>
</pre></div>


<h2 id="bean_6">Bean别名</h2>
<p>xml形式</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;person&quot;</span> <span class="na">name=</span><span class="s">&quot;person1, person2&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Person&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;alias</span> <span class="na">name=</span><span class="s">&quot;person&quot;</span> <span class="na">alias=</span><span class="s">&quot;person3&quot;</span><span class="nt">/&gt;</span>
</pre></div>


<p>注解方式</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>

<span class="c1">// 创建配置文件,可以认为是一个xml配置文件</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfiguration</span> <span class="o">{</span>
    <span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="o">{</span><span class="s">&quot;person1&quot;</span><span class="o">,</span> <span class="s">&quot;person2&quot;</span><span class="o">})</span>
    <span class="kd">public</span> <span class="n">Person</span> <span class="nf">person</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h2 id="bean_7">通过注解注入Bean</h2>
<ul>
<li>通过方法注入Bean<ul>
<li>通过构造方法注入Bean</li>
<li>通过Set方法注入Bean</li>
</ul>
</li>
<li>通过属性注入Bean</li>
<li>集合类Bean类型注入<ul>
<li>直接注入集合实例</li>
<li>将多个泛型的实例注入到集合<ul>
<li>将多个泛型实例注入到List</li>
<li>控制泛型示实例在List中的顺序</li>
<li>将多个泛型的实例注入到Map</li>
</ul>
</li>
</ul>
</li>
<li>String、Integer等类型直接赋值</li>
<li>SpringIoC容器内置接口示例注入</li>
</ul>
<p>准备Bean</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cat</span> <span class="o">{</span>
<span class="o">}</span>

<span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Dog</span> <span class="o">{</span>

<span class="o">}</span>

<span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Pig</span> <span class="o">{</span>
<span class="o">}</span>
</pre></div>


<p>配置文件</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.core.annotation.Order</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="c1">// 创建配置文件,可以认为是一个xml配置文件</span>
<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;com.demo.ioc&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfiguration</span> <span class="o">{</span>

    <span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;stringList&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">stringList</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Tom&quot;</span><span class="o">);</span>
        <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Jack&quot;</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 此优先级高于 List&lt;String&gt;</span>
    <span class="nd">@Bean</span>
    <span class="nd">@Order</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="c1">// 指定优先级</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">string1</span><span class="o">(){</span>
        <span class="k">return</span> <span class="s">&quot;string1&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="nd">@Order</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">string2</span><span class="o">(){</span>
        <span class="k">return</span> <span class="s">&quot;string2&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">stringIntegerMap</span><span class="o">(){</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;dog&quot;</span><span class="o">,</span> <span class="mi">23</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;pig&quot;</span><span class="o">,</span> <span class="mi">24</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">map</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 优先级高于 Map&lt;String, Integer&gt;</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">integer1</span><span class="o">(){</span>
        <span class="k">return</span> <span class="mi">222</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Integer</span> <span class="nf">integer2</span><span class="o">(){</span>
        <span class="k">return</span> <span class="mi">223</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>注入实例</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Qualifier</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Value</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>


<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">Dog</span> <span class="n">dog</span><span class="o">;</span>

    <span class="c1">// 1、构造方法注入</span>
    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="n">Dog</span> <span class="n">dog</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dog</span> <span class="o">=</span> <span class="n">dog</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">Cat</span> <span class="n">cat</span><span class="o">;</span>

    <span class="c1">// 2、Set方法注入</span>
    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCat</span><span class="o">(</span><span class="n">Cat</span> <span class="n">cat</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">cat</span> <span class="o">=</span> <span class="n">cat</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 3、通过属性注入</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">Pig</span> <span class="n">pig</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">stringList</span><span class="o">;</span>

    <span class="c1">// 4、注入List类型</span>
    <span class="nd">@Autowired</span>
    <span class="c1">// 指定Bean的ID</span>
    <span class="c1">// @Qualifier(value = &quot;stringList&quot;)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStringList</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">stringList</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">stringList</span> <span class="o">=</span> <span class="n">stringList</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getStringList</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">stringList</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 5、Map类型注入</span>
    <span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">stringIntegerMap</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">getStringIntegerMap</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">stringIntegerMap</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStringIntegerMap</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">stringIntegerMap</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">stringIntegerMap</span> <span class="o">=</span> <span class="n">stringIntegerMap</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="c1">// 6、String、Integer等类型直接赋值</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">&quot;Tom&quot;</span><span class="o">)</span> <span class="c1">// 如果是Integer会自动转型</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 7、容器内置接口注入</span>
    <span class="kd">private</span> <span class="n">ApplicationContext</span> <span class="n">context</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setContext</span><span class="o">(</span><span class="n">ApplicationContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">context</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ApplicationContext</span> <span class="nf">getContext</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">context</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;Person{&quot;</span> <span class="o">+</span>
                <span class="s">&quot;dog=&quot;</span> <span class="o">+</span> <span class="n">dog</span> <span class="o">+</span>
                <span class="s">&quot;, cat=&quot;</span> <span class="o">+</span> <span class="n">cat</span> <span class="o">+</span>
                <span class="s">&quot;, pig=&quot;</span> <span class="o">+</span> <span class="n">pig</span> <span class="o">+</span>
                <span class="s">&quot;, stringList=&quot;</span> <span class="o">+</span> <span class="n">stringList</span> <span class="o">+</span>
                <span class="s">&quot;, stringIntegerMap=&quot;</span> <span class="o">+</span> <span class="n">stringIntegerMap</span> <span class="o">+</span>
                <span class="s">&quot;, name=&#39;&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="sc">&#39;\&#39;&#39;</span> <span class="o">+</span>
                <span class="sc">&#39;}&#39;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>测试</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BeanTest</span> <span class="o">{</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testBean</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 获取上下文</span>
        <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span>
                <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">MyConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="c1">// 获取Bean</span>
        <span class="n">Person</span> <span class="n">bean</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&quot;person&quot;</span><span class="o">,</span> <span class="n">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bean</span><span class="o">.</span><span class="na">getStringList</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bean</span><span class="o">.</span><span class="na">getStringIntegerMap</span><span class="o">());</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bean</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getBean</span><span class="o">(</span><span class="s">&quot;cat&quot;</span><span class="o">));</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>测试输出</p>
<div class="codehilite"><pre><span></span><span class="n">Person</span><span class="p">{</span><span class="n">dog</span><span class="o">=</span><span class="n">com</span><span class="p">.</span><span class="n">demo</span><span class="p">.</span><span class="n">ioc</span><span class="p">.</span><span class="n">Dog</span><span class="mi">@441772</span><span class="n">e</span><span class="p">,</span> 
    <span class="n">cat</span><span class="o">=</span><span class="n">com</span><span class="p">.</span><span class="n">demo</span><span class="p">.</span><span class="n">ioc</span><span class="p">.</span><span class="n">Cat</span><span class="mi">@7334</span><span class="n">aada</span><span class="p">,</span> 
    <span class="n">pig</span><span class="o">=</span><span class="n">com</span><span class="p">.</span><span class="n">demo</span><span class="p">.</span><span class="n">ioc</span><span class="p">.</span><span class="n">Pig</span><span class="mi">@1</span><span class="n">d9b7cce</span><span class="p">,</span> 
    <span class="n">stringList</span><span class="o">=</span><span class="p">[</span><span class="n">string2</span><span class="p">,</span> <span class="n">string1</span><span class="p">],</span> 
    <span class="n">stringIntegerMap</span><span class="o">=</span><span class="p">{</span><span class="n">integer1</span><span class="o">=</span><span class="mi">222</span><span class="p">,</span> <span class="n">integer2</span><span class="o">=</span><span class="mi">223</span><span class="p">},</span> 
    <span class="n">name</span><span class="o">=</span><span class="err">&#39;</span><span class="n">Tom</span><span class="err">&#39;</span>
<span class="p">}</span>
<span class="p">[</span><span class="n">string2</span><span class="p">,</span> <span class="n">string1</span><span class="p">]</span>
<span class="p">{</span><span class="n">integer1</span><span class="o">=</span><span class="mi">222</span><span class="p">,</span> <span class="n">integer2</span><span class="o">=</span><span class="mi">223</span><span class="p">}</span>
<span class="n">com</span><span class="p">.</span><span class="n">demo</span><span class="p">.</span><span class="n">ioc</span><span class="p">.</span><span class="n">Cat</span><span class="mi">@7334</span><span class="n">aada</span>
</pre></div>


<h2 id="bean_8">通过注解设定Bean的作用域</h2>
<p>1、Spring预定义作用域</p>
<p>xml形式</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Person&quot;</span> <span class="na">scope=</span><span class="s">&quot;singleton&quot;</span><span class="nt">/&gt;</span>
</pre></div>


<p>注解形式</p>
<div class="codehilite"><pre><span></span><span class="nd">@Component</span>
<span class="nd">@Scope</span><span class="o">(</span><span class="s">&quot;singleton&quot;</span><span class="o">)</span>  <span class="c1">// prototype</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

<span class="o">}</span>

<span class="c1">// 或者</span>

<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;com.demo.ioc&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfiguration</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="nd">@Scope</span><span class="o">(</span><span class="s">&quot;singleton&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Person</span> <span class="nf">person</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
    <span class="o">}</span>
</pre></div>


<p>2、自定义Scope作用域</p>
<p>回忆之前的自定义Scope代码</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.ObjectFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.config.Scope</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.ConcurrentHashMap</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * 自定义作用域</span>
<span class="cm"> * 实现双例模式（每一个Bean对应两个实例）</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyScope</span> <span class="kd">implements</span> <span class="n">Scope</span> <span class="o">{</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">ObjectFactory</span><span class="o">&lt;?&gt;</span> <span class="n">objectFactory</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//先从map1取</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">map1</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">objectFactory</span><span class="o">.</span><span class="na">getObject</span><span class="o">();</span>
            <span class="n">map1</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">obj</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="c1">//再从map2取</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">map2</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">objectFactory</span><span class="o">.</span><span class="na">getObject</span><span class="o">();</span>
            <span class="n">map2</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">obj</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="c1">// 如果map1和map2中都存在则随机返回</span>
        <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">map1</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">map2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">remove</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// 和添加顺序正好相反</span>

        <span class="k">if</span><span class="o">(</span><span class="n">map2</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">name</span><span class="o">)){</span>
            <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">map2</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
            <span class="n">map2</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">if</span><span class="o">(</span><span class="n">map1</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">name</span><span class="o">)){</span>
            <span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">map1</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
            <span class="n">map1</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">obj</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">registerDestructionCallback</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Runnable</span> <span class="n">callback</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">resolveContextualObject</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getConversationId</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>xml形式</p>
<div class="codehilite"><pre><span></span><span class="c">&lt;!-- 1、将Scope交由Spring管理 --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;myScope&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.MyScope&quot;</span><span class="nt">/&gt;</span>

<span class="c">&lt;!-- 2、配置 --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;org.springframework.beans.factory.config.CustomScopeConfigurer&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;scopes&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;map&gt;</span>
            <span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">&quot;myScope&quot;</span> <span class="na">value-ref=</span><span class="s">&quot;myScope&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/map&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="c">&lt;!-- 3、使用 --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">scope=</span><span class="s">&quot;myScope&quot;</span><span class="nt">/&gt;</span>
</pre></div>


<p>注解形式</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.config.CustomScopeConfigurer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>

<span class="c1">// 创建配置文件,可以认为是一个xml配置文件</span>
<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;com.demo.ioc&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfiguration</span> <span class="o">{</span>

    <span class="c1">// 1、交由Spring管理</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">MyScope</span> <span class="nf">myScope</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">MyScope</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// 2、配置</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">CustomScopeConfigurer</span> <span class="nf">customScopeConfigurer</span><span class="o">(){</span>
        <span class="n">CustomScopeConfigurer</span> <span class="n">configurer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CustomScopeConfigurer</span><span class="o">();</span>
        <span class="n">configurer</span><span class="o">.</span><span class="na">addScope</span><span class="o">(</span><span class="s">&quot;myScope&quot;</span><span class="o">,</span> <span class="n">myScope</span><span class="o">());</span>
        <span class="k">return</span> <span class="n">configurer</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// 3、使用</span>
    <span class="nd">@Bean</span>
    <span class="nd">@Scope</span><span class="o">(</span><span class="s">&quot;myScope&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Person</span> <span class="nf">person</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>测试</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BeanTest</span> <span class="o">{</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testBean</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 获取上下文</span>
        <span class="n">ApplicationContext</span> <span class="n">context</span> <span class="o">=</span>
                <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">MyConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="c1">// 获取Bean</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">Person</span> <span class="n">bean</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&quot;person&quot;</span><span class="o">,</span> <span class="n">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bean</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h2 id="bean_9">Bean注解的方式进行方法注入</h2>
<p>回顾方法注入场景：<br />
Bean1是singleton, Bean2是prototype, Bean1依赖于Bean2<br />
我们希望每次调用Bean1某个方法时候，该方法每次拿到Bean2都是新的实例</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Bean2</span> <span class="o">{</span>

<span class="o">}</span>

<span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Bean1</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="kd">abstract</span> <span class="n">Bean2</span> <span class="nf">createBean2</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>


<p>xml方式</p>
<div class="codehilite"><pre><span></span><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean2&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean2&quot;</span> <span class="na">scope=</span><span class="s">&quot;prototype&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;bean1&quot;</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean1&quot;</span> <span class="na">scope=</span><span class="s">&quot;singleton&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;lookup-method</span> <span class="na">name=</span><span class="s">&quot;createBean2&quot;</span> <span class="na">bean=</span><span class="s">&quot;bean2&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>


<p>注解形式</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="nd">@Scope</span><span class="o">(</span><span class="s">&quot;prototype&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Bean2</span> <span class="o">{</span>

<span class="o">}</span>

<span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Bean1</span> <span class="o">{</span>
    <span class="nd">@Lookup</span>
    <span class="kd">protected</span> <span class="kd">abstract</span> <span class="n">Bean2</span> <span class="nf">createBean2</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>


<h2 id="bean_10">通过注解开启Bean的懒加载</h2>
<p>xml形式</p>
<div class="codehilite"><pre><span></span><span class="c">&lt;!-- 单个 --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&quot;com.demo.ioc.Bean&quot;</span> <span class="na">id=</span><span class="s">&quot;bean&quot;</span> <span class="na">lazy-init=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>

<span class="c">&lt;!-- 全局 --&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">default-lazy-init=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;&lt;/beans&gt;</span>
</pre></div>


<p>注解形式</p>
<div class="codehilite"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * 单个</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;com.demo.ioc&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfiguration</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="nd">@Lazy</span>
    <span class="kd">public</span> <span class="n">Person</span> <span class="nf">person</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// 或者</span>

<span class="nd">@Component</span>
<span class="nd">@Lazy</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

<span class="o">}</span>


<span class="cm">/**</span>
<span class="cm"> * 全局</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;com.demo.ioc&quot;</span><span class="o">)</span>
<span class="nd">@Lazy</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfiguration</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">Person</span> <span class="nf">person</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h2 id="bean_11">通过注解编写Bean初始化及销毁</h2>
<p>配置文件</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>

<span class="c1">// 创建配置文件,可以认为是一个xml配置文件</span>
<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;com.demo.ioc&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfiguration</span> <span class="o">{</span>

<span class="o">}</span>
</pre></div>


<p>上下文测试</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.support.AbstractApplicationContext</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BeanTest</span> <span class="o">{</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testBean</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 获取上下文</span>
        <span class="n">AbstractApplicationContext</span> <span class="n">context</span> <span class="o">=</span>
                <span class="k">new</span> <span class="n">AnnotationConfigApplicationContext</span><span class="o">(</span><span class="n">MyConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="n">Person</span> <span class="n">bean</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&quot;person&quot;</span><span class="o">,</span> <span class="n">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="n">context</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>方式一：</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.DisposableBean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.InitializingBean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>


<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="kd">implements</span> <span class="n">InitializingBean</span><span class="o">,</span> <span class="n">DisposableBean</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Person.destroy&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterPropertiesSet</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Person.afterPropertiesSet&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>方式二：</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.annotation.PostConstruct</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.annotation.PreDestroy</span><span class="o">;</span>


<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="nd">@PostConstruct</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onInit</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Person.onInit&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@PreDestroy</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Person.onDestroy&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>方式三</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onInit</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Person.onInit&quot;</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDestroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Person.onDestroy&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>通过Bean设置参数</p>
<div class="codehilite"><pre><span></span><span class="kn">package</span> <span class="nn">com.demo.ioc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.ComponentScan</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>


<span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;com.demo.ioc&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfiguration</span> <span class="o">{</span>

    <span class="nd">@Bean</span><span class="o">(</span><span class="n">initMethod</span> <span class="o">=</span> <span class="s">&quot;onInit&quot;</span><span class="o">,</span> <span class="n">destroyMethod</span> <span class="o">=</span> <span class="s">&quot;onDestroy&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Person</span> <span class="nf">person</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            2019-2021
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/mouday" class="md-footer-social__link fa fa-github"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.808e90bb.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
                <script src="../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../assets/javascripts/lunr/lunr.ja.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>